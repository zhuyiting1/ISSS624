<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.1.149">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Zhu Yiting">

<title>Learn with Yiting - Geospatial Analytics - Take-home Exercise 1</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>

  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Learn with Yiting - Geospatial Analytics</span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-hands-on-exercises" role="button" data-bs-toggle="dropdown" aria-expanded="false">Hands-on Exercises</a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-hands-on-exercises">    
        <li>
    <a class="dropdown-item" href="../../Hands-on_Ex1/Hands-on_Ex01.html">
 <span class="dropdown-text">Hands-on Exercise 1</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Hands-on_Ex2/Hands-on_Ex2.html">
 <span class="dropdown-text">Hands-on Exercise 2</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Hands-on_Ex3/Hands-on_Ex3.html">
 <span class="dropdown-text">Hands-on Exercise 3</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Hands-on_Ex4/Hands-on_Ex4.html">
 <span class="dropdown-text">Hands-on Exercise 4</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Hands-on_Ex5/Hands-on_Ex5.html">
 <span class="dropdown-text">Hands-on Exercise 5</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-in-class-exercises" role="button" data-bs-toggle="dropdown" aria-expanded="false">In-class Exercises</a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-in-class-exercises">    
        <li>
    <a class="dropdown-item" href="../../In-class_Ex/In-class_Ex1/In-class_Ex1.html">
 <span class="dropdown-text">In-class Exercise 1</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../In-class_Ex/In-class_Ex2/In-class_Ex2.html">
 <span class="dropdown-text">In-class Exercise 2</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../In-class_Ex/In-class_Ex3/In-class_Ex3.html">
 <span class="dropdown-text">In-class Exercise 3</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../In-class_Ex/In-class_Ex4/In-class_Ex4.html">
 <span class="dropdown-text">In-class Exercise 4</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../In-class_Ex/In-class_Ex5/In-class_Ex5.html">
 <span class="dropdown-text">In-class Exercise 5</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-take-home-exercises" role="button" data-bs-toggle="dropdown" aria-expanded="false">Take-home Exercises</a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-take-home-exercises">    
        <li>
    <a class="dropdown-item" href="../../Take-home_Ex/Take-home_Ex1/Take-home_Ex1.html">
 <span class="dropdown-text">Take-home Exercise 1</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Take-home_Ex/Take-home_Ex2/Take-home_Ex2.html">
 <span class="dropdown-text">Take-home Exercise 2</span></a>
  </li>  
    </ul>
  </li>
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../index.html">Home</a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../about.html">Acknowledgement</a>
  </li>  
</ul>
              <div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction">1. Introduction</a></li>
  <li><a href="#problem-statement-and-objective" id="toc-problem-statement-and-objective" class="nav-link" data-scroll-target="#problem-statement-and-objective">2. Problem Statement and Objective</a></li>
  <li><a href="#data-pre-preparation" id="toc-data-pre-preparation" class="nav-link" data-scroll-target="#data-pre-preparation">3. Data Pre-Preparation</a>
  <ul class="collapse">
  <li><a href="#water-point-data" id="toc-water-point-data" class="nav-link" data-scroll-target="#water-point-data">3.1. Water Point Data</a></li>
  <li><a href="#geographical-boundaries-of-nigeria" id="toc-geographical-boundaries-of-nigeria" class="nav-link" data-scroll-target="#geographical-boundaries-of-nigeria">3.2. Geographical Boundaries of Nigeria</a></li>
  </ul></li>
  <li><a href="#installing-and-loading-packages-in-r" id="toc-installing-and-loading-packages-in-r" class="nav-link" data-scroll-target="#installing-and-loading-packages-in-r">4. Installing and Loading Packages in R</a></li>
  <li><a href="#importing-geospatial-data-in-r" id="toc-importing-geospatial-data-in-r" class="nav-link" data-scroll-target="#importing-geospatial-data-in-r">5. Importing Geospatial Data in R</a>
  <ul class="collapse">
  <li><a href="#water-point-geospatial-data" id="toc-water-point-geospatial-data" class="nav-link" data-scroll-target="#water-point-geospatial-data">5.1. Water Point Geospatial Data</a></li>
  <li><a href="#nigeria-level-2-administrative-boundary-geospatial-data" id="toc-nigeria-level-2-administrative-boundary-geospatial-data" class="nav-link" data-scroll-target="#nigeria-level-2-administrative-boundary-geospatial-data">5.2. Nigeria Level-2 Administrative Boundary Geospatial Data</a></li>
  </ul></li>
  <li><a href="#data-wrangling-cleaning-and-extracting-the-necessary-data" id="toc-data-wrangling-cleaning-and-extracting-the-necessary-data" class="nav-link" data-scroll-target="#data-wrangling-cleaning-and-extracting-the-necessary-data">6. Data Wrangling: Cleaning and Extracting the Necessary Data</a>
  <ul class="collapse">
  <li><a href="#recoding-of-missing-water-point-status-data" id="toc-recoding-of-missing-water-point-status-data" class="nav-link" data-scroll-target="#recoding-of-missing-water-point-status-data">6.1. Recoding of Missing Water Point Status Data</a></li>
  <li><a href="#exploratory-data-analysis-eda" id="toc-exploratory-data-analysis-eda" class="nav-link" data-scroll-target="#exploratory-data-analysis-eda">6.2. Exploratory Data Analysis (EDA)</a></li>
  <li><a href="#extracting-water-point-data" id="toc-extracting-water-point-data" class="nav-link" data-scroll-target="#extracting-water-point-data">6.3. Extracting Water Point Data</a></li>
  <li><a href="#extracting-functional-water-points" id="toc-extracting-functional-water-points" class="nav-link" data-scroll-target="#extracting-functional-water-points">6.4. Extracting Functional Water Points</a></li>
  <li><a href="#extracting-non-functional-water-points" id="toc-extracting-non-functional-water-points" class="nav-link" data-scroll-target="#extracting-non-functional-water-points">6.5. Extracting Non-Functional Water Points</a></li>
  <li><a href="#extracting-water-point-with-unknown-class" id="toc-extracting-water-point-with-unknown-class" class="nav-link" data-scroll-target="#extracting-water-point-with-unknown-class">6.6. Extracting Water Point with Unknown Class</a></li>
  <li><a href="#performing-point-in-polygon-count" id="toc-performing-point-in-polygon-count" class="nav-link" data-scroll-target="#performing-point-in-polygon-count">6.7. Performing Point-in-Polygon Count</a></li>
  <li><a href="#saving-the-analytical-data-table" id="toc-saving-the-analytical-data-table" class="nav-link" data-scroll-target="#saving-the-analytical-data-table">6.8 Saving the Analytical Data Table</a></li>
  </ul></li>
  <li><a href="#visualising-the-spatial-distribution-of-water-points---thematic-mapping" id="toc-visualising-the-spatial-distribution-of-water-points---thematic-mapping" class="nav-link" data-scroll-target="#visualising-the-spatial-distribution-of-water-points---thematic-mapping">7. Visualising the Spatial Distribution of Water Points - Thematic Mapping</a>
  <ul class="collapse">
  <li><a href="#quick-plots-by-equal-classification" id="toc-quick-plots-by-equal-classification" class="nav-link" data-scroll-target="#quick-plots-by-equal-classification">7.1. Quick Plots by Equal Classification</a></li>
  <li><a href="#other-data-classification-methods" id="toc-other-data-classification-methods" class="nav-link" data-scroll-target="#other-data-classification-methods">7.2. Other Data Classification Methods</a></li>
  <li><a href="#calculating-and-plotting-water-point-density" id="toc-calculating-and-plotting-water-point-density" class="nav-link" data-scroll-target="#calculating-and-plotting-water-point-density">7.3. Calculating and Plotting Water Point Density</a></li>
  </ul></li>
  <li><a href="#analytical-mapping---overview" id="toc-analytical-mapping---overview" class="nav-link" data-scroll-target="#analytical-mapping---overview">8. Analytical Mapping - Overview</a></li>
  <li><a href="#computing-contiguity-spatial-weights" id="toc-computing-contiguity-spatial-weights" class="nav-link" data-scroll-target="#computing-contiguity-spatial-weights">9. Computing Contiguity Spatial Weights</a>
  <ul class="collapse">
  <li><a href="#computing-queens-contiguity-based-neighbours" id="toc-computing-queens-contiguity-based-neighbours" class="nav-link" data-scroll-target="#computing-queens-contiguity-based-neighbours">9.1. Computing Queen’s Contiguity-based Neighbours</a></li>
  <li><a href="#computing-rooks-contiguity-based-neighbours" id="toc-computing-rooks-contiguity-based-neighbours" class="nav-link" data-scroll-target="#computing-rooks-contiguity-based-neighbours">9.2. Computing Rook’s Contiguity-based Neighbours</a></li>
  <li><a href="#visualising-contiguity-based-neighbours" id="toc-visualising-contiguity-based-neighbours" class="nav-link" data-scroll-target="#visualising-contiguity-based-neighbours">9.3. Visualising Contiguity-based Neighbours</a></li>
  <li><a href="#row-standardised-queens-contiguity-weight-matrix" id="toc-row-standardised-queens-contiguity-weight-matrix" class="nav-link" data-scroll-target="#row-standardised-queens-contiguity-weight-matrix">9.4. Row-standardised Queen’s Contiguity Weight Matrix</a></li>
  <li><a href="#computing-fixed-distance-based-neighbours" id="toc-computing-fixed-distance-based-neighbours" class="nav-link" data-scroll-target="#computing-fixed-distance-based-neighbours">9.5. Computing Fixed Distance-based Neighbours</a></li>
  <li><a href="#determining-the-cut-off-distance" id="toc-determining-the-cut-off-distance" class="nav-link" data-scroll-target="#determining-the-cut-off-distance">Determining the Cut-off Distance</a></li>
  <li><a href="#computing-fixed-distance-weights-matrix" id="toc-computing-fixed-distance-weights-matrix" class="nav-link" data-scroll-target="#computing-fixed-distance-weights-matrix">Computing Fixed-Distance Weights Matrix</a></li>
  <li><a href="#plotting-fixed-distance-weight-matrix" id="toc-plotting-fixed-distance-weight-matrix" class="nav-link" data-scroll-target="#plotting-fixed-distance-weight-matrix">9.6. Plotting Fixed Distance Weight Matrix</a></li>
  <li><a href="#computing-adaptive-distance-weight-matrix" id="toc-computing-adaptive-distance-weight-matrix" class="nav-link" data-scroll-target="#computing-adaptive-distance-weight-matrix">9.7. Computing Adaptive Distance Weight Matrix</a></li>
  <li><a href="#plotting-adaptive-distance-based-neighbours" id="toc-plotting-adaptive-distance-based-neighbours" class="nav-link" data-scroll-target="#plotting-adaptive-distance-based-neighbours">9.8. Plotting Adaptive Distance-based Neighbours</a></li>
  <li><a href="#computing-inverse-distance-weight-idw-matrix" id="toc-computing-inverse-distance-weight-idw-matrix" class="nav-link" data-scroll-target="#computing-inverse-distance-weight-idw-matrix">9.9. Computing Inverse Distance Weight (IDW) Matrix</a></li>
  <li><a href="#evaluation-of-spatial-weighting-methods-in-the-case-of-nigeria" id="toc-evaluation-of-spatial-weighting-methods-in-the-case-of-nigeria" class="nav-link" data-scroll-target="#evaluation-of-spatial-weighting-methods-in-the-case-of-nigeria">9.10. Evaluation of Spatial Weighting Methods in the case of Nigeria</a></li>
  </ul></li>
  <li><a href="#global-spatial-autocorrelation" id="toc-global-spatial-autocorrelation" class="nav-link" data-scroll-target="#global-spatial-autocorrelation">10. Global Spatial Autocorrelation</a>
  <ul class="collapse">
  <li><a href="#global-spatial-autocorrelation-morans-i" id="toc-global-spatial-autocorrelation-morans-i" class="nav-link" data-scroll-target="#global-spatial-autocorrelation-morans-i">10.1. Global Spatial Autocorrelation: Moran’s I</a></li>
  <li><a href="#global-spatial-autocorrelation-gearys-c" id="toc-global-spatial-autocorrelation-gearys-c" class="nav-link" data-scroll-target="#global-spatial-autocorrelation-gearys-c">10.2. Global Spatial Autocorrelation: Geary’s C</a></li>
  </ul></li>
  <li><a href="#spatial-correlogram" id="toc-spatial-correlogram" class="nav-link" data-scroll-target="#spatial-correlogram">11. Spatial Correlogram</a>
  <ul class="collapse">
  <li><a href="#morans-i-correlogram" id="toc-morans-i-correlogram" class="nav-link" data-scroll-target="#morans-i-correlogram">11.1. Moran’s I Correlogram</a></li>
  <li><a href="#gearys-c-correlogram" id="toc-gearys-c-correlogram" class="nav-link" data-scroll-target="#gearys-c-correlogram">11.2. Geary’s C Correlogram</a></li>
  </ul></li>
  <li><a href="#cluster-and-outlier-analysis" id="toc-cluster-and-outlier-analysis" class="nav-link" data-scroll-target="#cluster-and-outlier-analysis">12. Cluster and Outlier Analysis</a>
  <ul class="collapse">
  <li><a href="#local-morans-i" id="toc-local-morans-i" class="nav-link" data-scroll-target="#local-morans-i">12.1. Local Moran’s I</a></li>
  <li><a href="#mapping-local-morans-i" id="toc-mapping-local-morans-i" class="nav-link" data-scroll-target="#mapping-local-morans-i">12.2. Mapping Local Moran’s I</a></li>
  </ul></li>
  <li><a href="#creating-a-lisa-cluster-map" id="toc-creating-a-lisa-cluster-map" class="nav-link" data-scroll-target="#creating-a-lisa-cluster-map">13. Creating a LISA Cluster Map</a>
  <ul class="collapse">
  <li><a href="#plotting-moran-scatterplot" id="toc-plotting-moran-scatterplot" class="nav-link" data-scroll-target="#plotting-moran-scatterplot">13.1. Plotting Moran Scatterplot</a></li>
  <li><a href="#plotting-moran-scatterplot-with-standardised-variables" id="toc-plotting-moran-scatterplot-with-standardised-variables" class="nav-link" data-scroll-target="#plotting-moran-scatterplot-with-standardised-variables">13.2. Plotting Moran Scatterplot with Standardised Variables</a></li>
  <li><a href="#preparing-lisa-map-classes" id="toc-preparing-lisa-map-classes" class="nav-link" data-scroll-target="#preparing-lisa-map-classes">13.3. Preparing LISA Map Classes</a></li>
  <li><a href="#plotting-lisa-map-for-non-functional-water-points" id="toc-plotting-lisa-map-for-non-functional-water-points" class="nav-link" data-scroll-target="#plotting-lisa-map-for-non-functional-water-points">13.4. Plotting LISA Map for Non-Functional Water Points</a></li>
  <li><a href="#plotting-lisa-map-for-functional-water-points" id="toc-plotting-lisa-map-for-functional-water-points" class="nav-link" data-scroll-target="#plotting-lisa-map-for-functional-water-points">13.5. Plotting LISA Map for Functional Water Points</a></li>
  </ul></li>
  <li><a href="#hot-spot-and-cold-spot-area-analysis" id="toc-hot-spot-and-cold-spot-area-analysis" class="nav-link" data-scroll-target="#hot-spot-and-cold-spot-area-analysis">14. Hot Spot and Cold Spot Area Analysis</a>
  <ul class="collapse">
  <li><a href="#getis-and-ords-g-statistics" id="toc-getis-and-ords-g-statistics" class="nav-link" data-scroll-target="#getis-and-ords-g-statistics">14.1. Getis and Ord’s G-Statistics</a></li>
  </ul></li>
  <li><a href="#computing-gi-statistics" id="toc-computing-gi-statistics" class="nav-link" data-scroll-target="#computing-gi-statistics">15. Computing Gi Statistics</a>
  <ul class="collapse">
  <li><a href="#gi-statistics-for-non-functional-water-points-using-fixed-distance" id="toc-gi-statistics-for-non-functional-water-points-using-fixed-distance" class="nav-link" data-scroll-target="#gi-statistics-for-non-functional-water-points-using-fixed-distance">15.1. Gi Statistics for Non-Functional Water Points Using Fixed Distance</a></li>
  <li><a href="#gi-statistics-for-non-functional-water-points-using-adaptivedistance" id="toc-gi-statistics-for-non-functional-water-points-using-adaptivedistance" class="nav-link" data-scroll-target="#gi-statistics-for-non-functional-water-points-using-adaptivedistance">15.2. Gi Statistics for Non-Functional Water Points Using AdaptiveDistance</a></li>
  <li><a href="#mapping-gi-values-for-non-functional-water-points-with-fixed-and-adaptive-distance-weights" id="toc-mapping-gi-values-for-non-functional-water-points-with-fixed-and-adaptive-distance-weights" class="nav-link" data-scroll-target="#mapping-gi-values-for-non-functional-water-points-with-fixed-and-adaptive-distance-weights">15.3. Mapping Gi Values for Non-Functional Water Points with Fixed and Adaptive Distance Weights</a></li>
  <li><a href="#gi-statistics-for-functional-water-points-using-fixed-distance" id="toc-gi-statistics-for-functional-water-points-using-fixed-distance" class="nav-link" data-scroll-target="#gi-statistics-for-functional-water-points-using-fixed-distance">15.4. Gi Statistics for Functional Water Points Using Fixed Distance</a></li>
  <li><a href="#gi-statistics-for-functional-water-points-using-adaptivedistance" id="toc-gi-statistics-for-functional-water-points-using-adaptivedistance" class="nav-link" data-scroll-target="#gi-statistics-for-functional-water-points-using-adaptivedistance">15.5. Gi Statistics for Functional Water Points Using AdaptiveDistance</a></li>
  <li><a href="#mapping-gi-values-for-functional-water-points-with-fixed-and-adaptive-distance-weights" id="toc-mapping-gi-values-for-functional-water-points-with-fixed-and-adaptive-distance-weights" class="nav-link" data-scroll-target="#mapping-gi-values-for-functional-water-points-with-fixed-and-adaptive-distance-weights">15.6. Mapping Gi Values for Functional Water Points with Fixed and Adaptive Distance Weights</a></li>
  </ul></li>
  <li><a href="#references" id="toc-references" class="nav-link" data-scroll-target="#references">16. References</a></li>
  <li><a href="#learning-points-from-peers" id="toc-learning-points-from-peers" class="nav-link" data-scroll-target="#learning-points-from-peers">17. Learning Points from Peers</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Take-home Exercise 1</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Zhu Yiting </p>
          </div>
  </div>
    
    
  </div>
  

</header>

<section id="introduction" class="level2">
<h2 class="anchored" data-anchor-id="introduction">1. Introduction</h2>
<p>Water is a scarce resource. With increasing pollution from various commercial activities, it becomes ever so difficult to obtain potable water for drinking, agriculture, sanitation and manufacturing. Particularly in developing countries, the lack of water sanitation has created major issues such as high rate of illness and mortality due to infection and malnutrition.</p>
<p>The United Nations (UN) estimate that 1.6 billion or close to 20% of people will lack safely managed drinking water in 2030 (UN, 2022). In Nigeria, an estimated 70% of water at the point of consumption is contaminated, which is a direct cause of Nigeria having the world’s largest number of deaths from waterborne diseases among children under five years old (VOA, 2022).</p>
<p><img src="images/paste-DF58ACBE.png" class="img-fluid" width="151"></p>
<p>Hence, ensuring the availability and sustainable management of water and sanitation for all remains one of the 17 Sustainable Development Goals (SDGs) of the UN.</p>
<p><img src="https://upload.wikimedia.org/wikipedia/commons/8/87/Sustainable_Development_Goal_6.png" class="img-fluid" width="114"></p>
</section>
<section id="problem-statement-and-objective" class="level2">
<h2 class="anchored" data-anchor-id="problem-statement-and-objective">2. Problem Statement and Objective</h2>
<p>In this study, we aim to perform geospatial analytics to reveal the spatial patterns, including the distribution and autocorrelation, of water points in Nigeria which are <u>non-functional</u>. This will be done using geospatial data on Level-2 Administrative Boundaries and water-points of Nigeria. The results of the analysis is a starting point to help inform policy decisions on the potential placement and maintenance of water points for more effective delivery of potable water to the people of Nigeria</p>
</section>
<section id="data-pre-preparation" class="level2">
<h2 class="anchored" data-anchor-id="data-pre-preparation">3. Data Pre-Preparation</h2>
<section id="water-point-data" class="level3">
<h3 class="anchored" data-anchor-id="water-point-data">3.1. Water Point Data</h3>
<p>We obtained the global water point and small water scheme level data from Water Point Data Exchange (WPdx) Global Data Repositories (WPdx, 2020). We accessed the <a href="https://data.waterpointdata.org/dataset/Water-Point-Data-Exchange-Plus-WPdx-/eqje-vguj/data">WPdx-Plus (WPdx+)</a> option and downloaded the full Shapefile under the Export option, as shown in the screenshot below. As the data consists of water points around the world, we will later filter for water points within Nigeria in R in a subsequent step.</p>
<p><img src="images/paste-68ACEDE9.png" class="img-fluid"></p>
<p>After downloading the Shapefile which can take a few minutes due to the large file size, unzip the folder and copy the Shapefiles (<code>.dbf</code>, <code>.prj</code>, <code>.shp</code> and <code>.shx</code>) into a data subfolder that shares the same directory as this Quarto file for ease of calling the files. We also want to rename all four files to <code>geo_export</code> so that we can reference these filenames more easily when we import the data.</p>
</section>
<section id="geographical-boundaries-of-nigeria" class="level3">
<h3 class="anchored" data-anchor-id="geographical-boundaries-of-nigeria">3.2. Geographical Boundaries of Nigeria</h3>
<p>We also need the geographical boundaries of Nigeria to make meaningful sense of its water point locations and to aid spatial visualisation. Here, we downloaded the Level-2 Administrative Boundaries (also known as Local Government Area (LGA)) data (ADM2) for Nigeria in year 2020 from <a href="https://www.geoboundaries.org/">geoBoundaries</a>, the largest open and free database of political administrative boundaries globally (geoBoundaries, 2022). The screenshot below shows the page for Shapefile data download. One can filter for Nigeria’s data by typing it in under the <code>Name</code> filter, followed by clicking on the download button under the column <code>geoBoundaries</code>, sub-column <code>Full Release</code> and for the row <code>Nigeria</code>, <code>NGA</code>, <code>ADM2</code>, <code>2020</code>.</p>
<p><img src="images/paste-26F0289E.png" class="img-fluid" width="501"></p>
<p>Similar to the water point data, we unzip the folder and copy the Shapefiles (<code>.dbf</code>, <code>.prj</code>, <code>.shp</code> and <code>.shx</code>) into the same folder as the water points Shapefiles. Here, we rename the files to <code>geoBoundaries-NGA-ADM2</code> to indicate the data source (geoBoundaries), country (NGA) and administrative boundary level (ADM2).</p>
</section>
</section>
<section id="installing-and-loading-packages-in-r" class="level2">
<h2 class="anchored" data-anchor-id="installing-and-loading-packages-in-r">4. Installing and Loading Packages in R</h2>
<p>The code chunk below uses <a href="https://www.rdocumentation.org/packages/pacman/versions/0.5.1/topics/p_load"><em>p_load()</em></a> from <strong>pacman</strong> package to brings in the R packages for:</p>
<ol type="1">
<li>Spatial vector data encoding (<a href="https://r-spatial.github.io/sf/"><strong>sf</strong></a>);</li>
<li>Data-wrangling (<a href="https://www.tidyverse.org/"><strong>tidyverse</strong></a>);</li>
<li>Map plotting (<a href="https://cran.r-project.org/web/packages/tmap/vignettes/tmap-getstarted.html"><strong>tmap</strong></a>);</li>
<li>Geospatial analysis (<a href="https://cran.r-project.org/web/packages/spdep/index.html"><strong>spdep</strong></a>); and</li>
<li>Rapid Exploratory Data Analysis (EDA) (<a href="https://cran.r-project.org/web/packages/funModeling/vignettes/funModeling_quickstart.html"><strong>funModeling</strong></a>).</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(sf, tidyverse, tmap, spdep, funModeling)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="importing-geospatial-data-in-r" class="level2">
<h2 class="anchored" data-anchor-id="importing-geospatial-data-in-r">5. Importing Geospatial Data in R</h2>
<section id="water-point-geospatial-data" class="level3">
<h3 class="anchored" data-anchor-id="water-point-geospatial-data">5.1. Water Point Geospatial Data</h3>
<p>We are now ready to import the geospatial data into the Quarto document. The code chunk below does so for the water point data by using <a href="https://www.rdocumentation.org/packages/sf/versions/0.2-2/topics/st_read"><em>st_read()</em></a> function of the <strong>sf</strong> package. We specified the data source name (<code>dsn</code>) or directory of the file (<code>"data/geospatial"</code>), <code>layer</code> for the name of the Shapefiles (<code>"geo_export"</code>), and <code>crs = 4326</code> to import the data in <strong>wgs84</strong> geographic coordinate reference system (CRS), since the Shapefile is in <strong>wgs84</strong>. We also pipe a filter to obtain data that are in Nigeria only, by using the <a href="https://dplyr.tidyverse.org/reference/filter.html"><em>filter()</em></a> function of <strong>dplyr</strong> package from <strong>tidyverse</strong>. The clean_country_name column is used for the filter, and note that the column name is truncated in the Shapefile due to character limit and should be keyed in correctly to perform the filter successfully.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>wp <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="at">dsn =</span> <span class="st">"data/geospatial"</span>,</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>              <span class="at">layer =</span> <span class="st">"geo_export"</span>,</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>              <span class="at">crs =</span> <span class="dv">4326</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(clean_coun <span class="sc">==</span> <span class="st">"Nigeria"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>One point to note is that while we can theoretically transform the data to projected CRS directly by using the <a href="https://r-spatial.github.io/sf/reference/st_transform.html"><em>st_transform()</em></a> function of <strong>sf</strong> to facilitate the accurate computation of distances in a planar configuration, we want to keep it on hold for now as it will result in missing data points when we use <a href="https://cran.r-project.org/web/packages/sf/vignettes/sf3.html"><em>st_intersects()</em></a> subsequently to identify water points within each administrative boundary. This is because <em>st_intersects()</em> only works correctly if the geospatial data are in geographic CRS.</p>
<p>The simple feature data frame comprises 95,008 observations of 73 variables. In particular, we are interested in the variable status_clean (truncated to <code>status_cle</code> in the Shapefile), which tells us which water points are functional versus not. In addition, we will use the last variable, <code>geometry</code>, to perform data join for the recoded variables to the LGA boundaries data.</p>
<p>On a practical note, to avoid taking up too much memory space in GitHub, which has a memory limit of 100MB, we will extract the necessary data and save them in an rds file, and delete the <code>geo_export</code> Shapefiles from the <code>data/geospatial</code> folder, <u>before</u> committing and pushing the changes to GitHub. This is to prevent error in the process of pushing the commit to GitHub. We do so by running the relevant code chunks below and saving the rds file in the <code>data/spatial</code> folder, and then setting <code>#| eval: false</code> so that the codes that use the original Shapefiles and intermediate large files will not run when knitted. This way, those codes will be suppressed when rendering the Quarto file and analysis can be done using the eventual rds file.</p>
<blockquote class="blockquote">
<p>Should we wish to run certain lines of codes that are suppressed, we can set to <code>#| eval: true</code> to allow normal evaluation during rendering, or run it manually in the RStudio environment.</p>
</blockquote>
<p>In the code chunk below, <a href="https://readr.tidyverse.org/reference/read_rds.html"><em>write_rds()</em></a> of the <strong>readr</strong> package is used to save the extracted sf data table into an output file in rds data format. We then do not need to go back to the original Shapefile to reload the full set of global water points data each time we use it, as the data size is very large, the time to load is long&nbsp;and it cannot be pushed to GitHub.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>wp_nga <span class="ot">&lt;-</span> <span class="fu">write_rds</span>(wp, <span class="st">"data/geospatial/wp_nga.rds"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>However, do note that after running the above code chunk, the wp_nga.rds file is still too large (140.2MB) to push to GitHub (100MB limit). Hence, we will further extract only the data that we wish to use for our analysis and save it as another .rds file, and remove this one, indicate <code>#| eval: false</code>&nbsp;and delete the wp_nga.rds file from our directory, before we commit and push the changes to GitHub.</p>
</section>
<section id="nigeria-level-2-administrative-boundary-geospatial-data" class="level3">
<h3 class="anchored" data-anchor-id="nigeria-level-2-administrative-boundary-geospatial-data">5.2. Nigeria Level-2 Administrative Boundary Geospatial Data</h3>
<p>We also import the Nigeria Level-2 Administrative Boundary (LGA) data into our Quarto file, similarly using <em>st_read()</em> of <strong>sf</strong> in the code chunk below. The data are saved in the form of a simple feature data table <code>nga</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>nga <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="at">dsn =</span> <span class="st">"data/geospatial"</span>,</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>              <span class="at">layer =</span> <span class="st">"geoBoundaries-NGA-ADM2"</span>,</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>              <span class="at">crs =</span> <span class="dv">4326</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Reading layer `geoBoundaries-NGA-ADM2' from data source 
  `C:\zhuyiting1\ISSS624\Take-home_Ex\Take-home_Ex1\data\geospatial' 
  using driver `ESRI Shapefile'
Simple feature collection with 774 features and 5 fields
Geometry type: MULTIPOLYGON
Dimension:     XY
Bounding box:  xmin: 2.668534 ymin: 4.273007 xmax: 14.67882 ymax: 13.89442
Geodetic CRS:  WGS 84</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(nga)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 774
Columns: 6
$ shapeName  &lt;chr&gt; "Aba North", "Aba South", "Abadam", "Abaji", "Abak", "Abaka…
$ Level      &lt;chr&gt; "ADM2", "ADM2", "ADM2", "ADM2", "ADM2", "ADM2", "ADM2", "AD…
$ shapeID    &lt;chr&gt; "NGA-ADM2-72505758B79815894", "NGA-ADM2-72505758B67905963",…
$ shapeGroup &lt;chr&gt; "NGA", "NGA", "NGA", "NGA", "NGA", "NGA", "NGA", "NGA", "NG…
$ shapeType  &lt;chr&gt; "ADM2", "ADM2", "ADM2", "ADM2", "ADM2", "ADM2", "ADM2", "AD…
$ geometry   &lt;MULTIPOLYGON [°]&gt; MULTIPOLYGON (((7.401109 5...., MULTIPOLYGON (…</code></pre>
</div>
</div>
<p>There are 774 observations of 6 variables in the <code>nga</code> file, including <code>shapeName</code> for the LGA that each region belongs to and <code>geometry</code> for the polygons, as seen using the <a href="https://dplyr.tidyverse.org/reference/glimpse.html"><em>glimpse()</em></a> function of <strong>dplyr</strong> above. The geometry type is <strong>multipolygon</strong>. It is also in the <strong>wgs84</strong> geographic CRS, just like the water point data. Hence for now, there is no need to perform <em>st_transform()</em> to align their CRS.</p>
<p>We also run a check for invalid geometries in the LGA data, using <a href="https://r-spatial.github.io/sf/reference/valid.html"><em>st_is_valid()</em></a> of <strong>sf</strong>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(<span class="fu">which</span>(<span class="fu">st_is_valid</span>(nga) <span class="sc">==</span> <span class="cn">FALSE</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0</code></pre>
</div>
</div>
<p>The output is 0 - there is no invalid geometry for the LGA polygons.</p>
<p>We also check for missing values in the LGA data, using <a href="https://www.rdocumentation.org/packages/ursa/versions/3.9.4/topics/is.na"><em>is.na()</em></a> of <strong>ursa</strong> to return <code>TRUE</code>/<code>FALSE</code> values and <a href="https://www.rdocumentation.org/packages/raster/versions/2.9-5/topics/rowSums"><em>rowSums()</em></a> of <strong>raster</strong> to tally the number of <code>TRUE</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>nga[<span class="fu">rowSums</span>(<span class="fu">is.na</span>(nga))<span class="sc">!=</span><span class="dv">0</span>,]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Simple feature collection with 0 features and 5 fields
Bounding box:  xmin: NA ymin: NA xmax: NA ymax: NA
Geodetic CRS:  WGS 84
[1] shapeName  Level      shapeID    shapeGroup shapeType  geometry  
&lt;0 rows&gt; (or 0-length row.names)</code></pre>
</div>
</div>
</section>
</section>
<section id="data-wrangling-cleaning-and-extracting-the-necessary-data" class="level2">
<h2 class="anchored" data-anchor-id="data-wrangling-cleaning-and-extracting-the-necessary-data">6. Data Wrangling: Cleaning and Extracting the Necessary Data</h2>
<section id="recoding-of-missing-water-point-status-data" class="level3">
<h3 class="anchored" data-anchor-id="recoding-of-missing-water-point-status-data">6.1. Recoding of Missing Water Point Status Data</h3>
<p>In the code chunk below, we use <a href="https://tidyr.tidyverse.org/reference/replace_na.html"><em>replace_na()</em></a> of <strong>tidyr</strong> to replace the “NA” data in the <code>status_cle</code> variable with “Unknown”, as this is the variable that will be used subsequently. This is so that the observations with “NA” will not be excluded in subsequent analyses.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>wp_nga <span class="ot">&lt;-</span> <span class="fu">read_rds</span>(<span class="st">"data/geospatial/wp_nga.rds"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">status_cle =</span> <span class="fu">replace_na</span>(status_cle, <span class="st">"Unknown"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="exploratory-data-analysis-eda" class="level3">
<h3 class="anchored" data-anchor-id="exploratory-data-analysis-eda">6.2. Exploratory Data Analysis (EDA)</h3>
<p>In the code chunk below, we use <a href="https://www.rdocumentation.org/packages/funModeling/versions/1.9.4/topics/freq"><em>freq()</em></a> of <strong>funModeling</strong> to display the distribution of <code>status_cle</code> field in <code>wp_nga</code> for a quick view of the available classes and their distributions. As we need to suppress this code chunk due to file size limit when we commit the changes and push to GitHub, the bar chart is saved as image and reproduced below.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">freq</span>(<span class="at">data =</span> wp_nga,</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>     <span class="at">input =</span> <span class="st">"status_cle"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><img src="images/paste-EB7E5732.png" class="img-fluid"></p>
<p>We see that there are 3 <code>status_cle</code> values that describe functional water points, namely</p>
<ol type="1">
<li><p><code>Functional</code> (45,883, 48%),</p></li>
<li><p><code>Functional but needs repair</code> (4,579, 5%), and</p></li>
<li><p><code>Functional but not in use</code> (1,686, 2%).</p></li>
</ol>
<p>On the other hand, there are 5 values which indicate that the water points are not functional, including 7 mis-coded values due to a missing hyphen and lower “f”, and they are</p>
<ol type="1">
<li><code>Non-Functional</code> (29,385, 31%)</li>
<li><code>Non-Functional due to dry season</code> (2,403, 3%)</li>
<li><code>Abandoned/Decommissioned</code> (234, &lt;1%)</li>
<li><code>Abandoned</code> (175, &lt;1%)</li>
<li><code>Non functional due to dry season</code> (7, &lt;1%)</li>
</ol>
<p>We see that over 1/3 of the water points are non-functional.</p>
<p>There are also 10,656 or 11% missing values which we recoded to <code>Unknown</code> using <em>replace_na()</em>.</p>
</section>
<section id="extracting-water-point-data" class="level3">
<h3 class="anchored" data-anchor-id="extracting-water-point-data">6.3. Extracting Water Point Data</h3>
<p>In this section, we will extract the water point records by using the classes that we saw above in <code>status_cle</code> field. This will help us obtain the absolute numbers as well as allow us to calculate the % total later.</p>
</section>
<section id="extracting-functional-water-points" class="level3">
<h3 class="anchored" data-anchor-id="extracting-functional-water-points">6.4. Extracting Functional Water Points</h3>
<p>In the code chunk below, we extract the data for the functional water points into <code>wpt_functional</code> using <em>filter()</em> of <strong>dplyr</strong> for the 3 classes that we identified using <em>freq()</em> of <strong>funModeling</strong>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>wpt_functional <span class="ot">&lt;-</span> wp_nga <span class="sc">%&gt;%</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(status_cle <span class="sc">%in%</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>           <span class="fu">c</span>(<span class="st">"Functional"</span>,</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>             <span class="st">"Functional but not in use"</span>,</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>             <span class="st">"Functional but needs repair"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Running <em>freq()</em> on <code>wpt_functional</code> to check, we can see that the same number of records for the 3 functional classes are captured as per in <code>wp_nga</code>. We similarly saved a copy of the frequency image below as we will suppress the evaluation of the code chunk below due to file size constraint.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">freq</span>(<span class="at">data =</span> wpt_functional,</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>     <span class="at">input =</span> <span class="st">"status_cle"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><img src="images/paste-7E4F7360.png" class="img-fluid"></p>
</section>
<section id="extracting-non-functional-water-points" class="level3">
<h3 class="anchored" data-anchor-id="extracting-non-functional-water-points">6.5. Extracting Non-Functional Water Points</h3>
<p>We repeat the above process for non-functional water points, using the code chunks below.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>wpt_nonfunctional <span class="ot">&lt;-</span> wp_nga <span class="sc">%&gt;%</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(status_cle <span class="sc">%in%</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>           <span class="fu">c</span>(<span class="st">"Abandoned/Decommissioned"</span>, </span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>             <span class="st">"Abandoned"</span>,</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>             <span class="st">"Non-Functional"</span>,</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>             <span class="st">"Non functional due to dry season"</span>,</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>             <span class="st">"Non-Functional due to dry season"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">freq</span>(<span class="at">data=</span>wpt_nonfunctional, </span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>     <span class="at">input =</span> <span class="st">'status_cle'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><img src="images/paste-E1FABBDF.png" class="img-fluid"></p>
</section>
<section id="extracting-water-point-with-unknown-class" class="level3">
<h3 class="anchored" data-anchor-id="extracting-water-point-with-unknown-class">6.6. Extracting Water Point with Unknown Class</h3>
<p>Finally, for completeness, we also need to extract the water points with unknown status (missing <code>status_cle</code> field), using the code chunk below. Using <a href="https://www.rdocumentation.org/packages/utils/versions/3.6.2/topics/str"><em>str()</em></a> of R’s <strong>utils</strong>, we confirm that the number of observations (10,656) tallies with that in the earlier frequency bar chart plotted using <em>freq()</em> of <strong>funModeling</strong>. A screenshot of the top part of the internal structure of <code>wpt_unknown</code> is shown below.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>wpt_unknown <span class="ot">&lt;-</span> wp_nga <span class="sc">%&gt;%</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(status_cle <span class="sc">==</span> <span class="st">"Unknown"</span>)</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(wpt_unknown)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><img src="images/paste-CA51DD1F.png" class="img-fluid"></p>
</section>
<section id="performing-point-in-polygon-count" class="level3">
<h3 class="anchored" data-anchor-id="performing-point-in-polygon-count">6.7. Performing Point-in-Polygon Count</h3>
<p>We want to find the number and proportion of functional, non-functional and unknown water points within each LGA. To do this, we use <em>st_intersects()</em> of <strong>sf</strong> to determine the cross-over between the LGA polygons in <code>nga</code> and water points in <code>wp_nga</code>. Thereafter, <a href="https://www.rdocumentation.org/packages/base/versions/3.6.2/topics/lengths"><em>lengths()</em></a> of <strong>Base R</strong> is used to return the number of water points in each class by LGA. Finally, we use <a href="https://dplyr.tidyverse.org/reference/mutate.html"><em>mutate()</em></a> of <strong>dplyr</strong> to add the new variables for <code>total wpt</code>, <code>wpt functional</code>, <code>wpt non-functional</code> and <code>wpt unknown</code> to <code>nga</code> sf data table, and assign it to a new variable <code>nga_wp</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>nga_wp <span class="ot">&lt;-</span> nga <span class="sc">%&gt;%</span> </span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="st">`</span><span class="at">total wpt</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">lengths</span>(</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">st_intersects</span>(nga, wp_nga))) <span class="sc">%&gt;%</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="st">`</span><span class="at">wpt functional</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">lengths</span>(</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">st_intersects</span>(nga, wpt_functional))) <span class="sc">%&gt;%</span></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="st">`</span><span class="at">wpt non-functional</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">lengths</span>(</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">st_intersects</span>(nga, wpt_nonfunctional))) <span class="sc">%&gt;%</span></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="st">`</span><span class="at">wpt unknown</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">lengths</span>(</span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">st_intersects</span>(nga, wpt_unknown)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Note that the symbol used is ” ` ” (backtick) and not ” ’ ” (apostrophe). This is used when there is space and hyphen (-) in the variable name (e.g.&nbsp;<code>total wpt</code>).</p>
<p>Thereafter, we compute the percentage functional and percentage non-functional water points as <code>pct_functional</code> and <code>pct_non-functional</code>, using <em>mutate()</em> of <strong>dplyr</strong> in the code chunk below.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>nga_wp <span class="ot">&lt;-</span> nga_wp <span class="sc">%&gt;%</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">pct_functional =</span> <span class="st">`</span><span class="at">wpt functional</span><span class="st">`</span><span class="sc">/</span><span class="st">`</span><span class="at">total wpt</span><span class="st">`</span>) <span class="sc">%&gt;%</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="st">`</span><span class="at">pct_non-functional</span><span class="st">`</span> <span class="ot">=</span> <span class="st">`</span><span class="at">wpt non-functional</span><span class="st">`</span><span class="sc">/</span><span class="st">`</span><span class="at">total wpt</span><span class="st">`</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="saving-the-analytical-data-table" class="level3">
<h3 class="anchored" data-anchor-id="saving-the-analytical-data-table">6.8 Saving the Analytical Data Table</h3>
<p>With the tidy sf data table, we save it in rds file format as <code>nga_wp.rds</code> for subsequent analysis, using <em>write_rds()</em> of <strong>readr</strong>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">write_rds</span>(nga_wp, <span class="st">"data/geospatial/nga_wp.rds"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Before we move on to the next section on spatial analysis, we will set <code>#| eval: false</code> for all code chunks that rely on either the <code>geo_export</code> Shapefiles or <code>wp_nga</code> as the files are too large and need to be deleted before committing and pushing the changes to GitHub. We will work with the <code>geoBoundaries-NGA-ADM2</code>&nbsp;Shapefiles and <code>nga_wp.rds</code> file, which is only around 2.1MB in size respectively.</p>
</section>
</section>
<section id="visualising-the-spatial-distribution-of-water-points---thematic-mapping" class="level2">
<h2 class="anchored" data-anchor-id="visualising-the-spatial-distribution-of-water-points---thematic-mapping">7. Visualising the Spatial Distribution of Water Points - Thematic Mapping</h2>
<p>To avoid error with the removal of the large data files and suppression of the relevant code chunks above, we use <em>read_rds()</em> to load the <code>nga_wp.rds</code> file at the start of the next section of our analysis.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>nga_wp <span class="ot">&lt;-</span> <span class="fu">read_rds</span>(<span class="st">"data/geospatial/nga_wp.rds"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>As we have performed <em>st_intersects()</em>, we can use <em>st_transform()</em> of <strong>sf</strong> to convert the data from an ellipsoid <strong>wgs84</strong> CRS to a planar projected CRS via mathematical reprojection of the coordinates, prior to distance calculations. This is done using EPSG: 26392 for Minna / Nigeria Mid Belt (Spatial Reference, 2022), in the code chunk below. We also check that the transformation has been done correctly using <em>st_geometry()</em> of <strong>sf</strong>, where the projected CRS field indicates <code>Minna / Nigeria Mid Belt</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>nga_wp26392 <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(nga_wp, </span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>                            <span class="at">crs =</span> <span class="dv">26392</span>)</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a><span class="fu">st_geometry</span>(nga_wp26392)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Geometry set for 774 features 
Geometry type: MULTIPOLYGON
Dimension:     XY
Bounding box:  xmin: 26662.71 ymin: 30523.38 xmax: 1344157 ymax: 1096029
Projected CRS: Minna / Nigeria Mid Belt
First 5 geometries:</code></pre>
</div>
</div>
<p>We see that the bounding box values have changed from the decimal degree format where the minimum and maximum values of x and y were between 2.7<sup>o</sup> and 14.7<sup>o</sup>, to between 26,663m and 1,344,157m (MapTools, 2022; epsg.io, 2022).</p>
<p>We set <a href="https://www.rdocumentation.org/packages/tmap/versions/3.3-3/topics/tmap_mode"><em>tmap_mode()</em></a> of <strong>tmap</strong> to “view” to activate interactive viewing mode instead of static maps, to better zoom into any of the 774 LGAs for further analysis if needed. Nevertheless, for the purpose of limiting the file size in view of the limited memory on GitHub, we will use the “plot” option to display static maps in this report.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tmap_mode</span>(<span class="st">"view"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tmap_mode</span>(<span class="st">"plot"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>In the code chunk below, we plot the <strong>wgs84</strong> and <code>crs = 26392</code> versions of the Nigerian LGA using <a href="https://www.rdocumentation.org/packages/tmap/versions/3.3-3/topics/tm_shape"><em>tm_shape()</em></a> of <strong>tmap</strong>, and note that the latter appears to flatten the mapping area out a little more than the former. We can also see that the plots are now in interactive mode.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>nga_wp_wgs <span class="ot">&lt;-</span> <span class="fu">tm_shape</span>(nga_wp) <span class="sc">+</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_borders</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_layout</span>(<span class="at">main.title =</span> <span class="st">"Geographic CRS"</span>,</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>            <span class="at">main.title.position =</span> <span class="st">"center"</span>)</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>nga_wp_proj <span class="ot">&lt;-</span> <span class="fu">tm_shape</span>(nga_wp26392) <span class="sc">+</span></span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_borders</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_layout</span>(<span class="at">main.title =</span> <span class="st">"Projected CRS"</span>,</span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>            <span class="at">main.title.position =</span> <span class="st">"center"</span>)</span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a><span class="fu">tmap_arrange</span>(nga_wp_wgs, nga_wp_proj, <span class="at">asp =</span> <span class="dv">1</span>, <span class="at">ncol =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Take-home_Ex1_files/figure-html/unnamed-chunk-22-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<section id="quick-plots-by-equal-classification" class="level3">
<h3 class="anchored" data-anchor-id="quick-plots-by-equal-classification">7.1. Quick Plots by Equal Classification</h3>
<p>The code chunk below uses <a href="https://www.rdocumentation.org/packages/tmap/versions/3.3-3/topics/qtm"><em>qtm()</em></a> of <strong>tmap</strong> to do a quick thematic map plot of the Nigeria LGA, coloured by the number of water points in equal classification method. The four quadrants represent (from top left in a “Z” shape) total water points, functional water points, non-functional water points and water points with unknown functionality status.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>total <span class="ot">&lt;-</span> <span class="fu">qtm</span>(nga_wp26392, <span class="st">"total wpt"</span>)</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>wp_functional <span class="ot">&lt;-</span> <span class="fu">qtm</span>(nga_wp26392, <span class="st">"wpt functional"</span>)</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>wp_nonfunctional <span class="ot">&lt;-</span> <span class="fu">qtm</span>(nga_wp26392, <span class="st">"wpt non-functional"</span>)</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>unknown <span class="ot">&lt;-</span> <span class="fu">qtm</span>(nga_wp26392, <span class="st">"wpt unknown"</span>)</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a><span class="fu">tmap_arrange</span>(total, wp_functional, wp_nonfunctional, unknown, <span class="at">asp=</span><span class="dv">1</span>, <span class="at">ncol=</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Take-home_Ex1_files/figure-html/unnamed-chunk-23-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>By zooming into the choropleth maps and clicking on the areas of interest, we see that Babura has the most number of total water points at 894. There are 11 LGAs in the Northeast region that are without any water points at all, namely Geidam, Mobbar, Abadam, Kukawa, Guzamala, Nganzai, Gubio, Marte, Kala/Balge, Kaga and Gujba.</p>
<p>The general patterns of the functional water points appear similar. We see that in Chikun, there are 4 water points in total but 0 functional ones.</p>
<p>For non-functional water points, they are mainly found in Ifelodun (278) and Igabi (216), forming 46% and 74% of all water points found in those regions, suggesting that heavy replacement or maintenance work may be needed there.</p>
<p>The water points with unknown status information are mainly found in the Central (e.g.&nbsp;Pankshin, Shendam) and South regions (e.g.&nbsp;Izzi, Ikwo).</p>
<p>We also visualise the functional and non-functional water points by their proportions of the total number of water points in each LGA, using the code chunk below.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>pct_wp_functional <span class="ot">&lt;-</span> <span class="fu">qtm</span>(nga_wp26392, <span class="st">"pct_functional"</span>)</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>pct_wp_nonfunctional <span class="ot">&lt;-</span> <span class="fu">qtm</span>(nga_wp26392, <span class="st">"pct_non-functional"</span>)</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a><span class="fu">tmap_arrange</span>(pct_wp_functional, pct_wp_nonfunctional, <span class="at">asp=</span><span class="dv">1</span>, <span class="at">ncol=</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Take-home_Ex1_files/figure-html/unnamed-chunk-24-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>On the left plot, we see that the the highest proportion of functional water points are mostly found in the North half of Nigeria. On the right plot, the proportion of non-functional water points tend to be more dispersed in the remaining LGAs. In general, there are less LGAs with high proportion of non-functional water points compared to that of functional ones.</p>
</section>
<section id="other-data-classification-methods" class="level3">
<h3 class="anchored" data-anchor-id="other-data-classification-methods">7.2. Other Data Classification Methods</h3>
<p>We also try visualising the spatial distribution of functional and non-functional water point proportions at LGA level using quantile, Jenks (natural breaks), pretty and Kmeans styles in <a href="https://www.rdocumentation.org/packages/tmap/versions/3.3-3/topics/tm_fill"><em>tm_fill()</em></a> of <strong>tmap</strong>, by using <a href="https://www.rdocumentation.org/packages/tmap/versions/3.3-3/topics/tm_shape"><em>tm_shape()</em></a> to create customisable choropleth plots.</p>
<section id="functional-water-point-proportion" class="level4">
<h4 class="anchored" data-anchor-id="functional-water-point-proportion">Functional water point proportion</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>func_quantile <span class="ot">&lt;-</span> <span class="fu">tm_shape</span>(nga_wp26392) <span class="sc">+</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_fill</span>(<span class="st">"pct_functional"</span>,</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>          <span class="at">n =</span> <span class="dv">5</span>,</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>          <span class="at">style =</span> <span class="st">"quantile"</span>, </span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>          <span class="at">title =</span> <span class="st">"Functional: Quantile"</span>) <span class="sc">+</span></span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_borders</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_layout</span>(<span class="at">legend.height =</span> <span class="fl">0.25</span>, </span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>            <span class="at">legend.width =</span> <span class="fl">0.35</span>,</span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a>            <span class="at">frame =</span> <span class="cn">TRUE</span>)</span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a>func_jenks <span class="ot">&lt;-</span> <span class="fu">tm_shape</span>(nga_wp26392) <span class="sc">+</span></span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_fill</span>(<span class="st">"pct_functional"</span>,</span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a>          <span class="at">n =</span> <span class="dv">5</span>,</span>
<span id="cb30-13"><a href="#cb30-13" aria-hidden="true" tabindex="-1"></a>          <span class="at">style =</span> <span class="st">"jenks"</span>, </span>
<span id="cb30-14"><a href="#cb30-14" aria-hidden="true" tabindex="-1"></a>          <span class="at">title =</span> <span class="st">"Functional: Jenks"</span>) <span class="sc">+</span></span>
<span id="cb30-15"><a href="#cb30-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_borders</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb30-16"><a href="#cb30-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_layout</span>(<span class="at">legend.height =</span> <span class="fl">0.25</span>, </span>
<span id="cb30-17"><a href="#cb30-17" aria-hidden="true" tabindex="-1"></a>            <span class="at">legend.width =</span> <span class="fl">0.35</span>,</span>
<span id="cb30-18"><a href="#cb30-18" aria-hidden="true" tabindex="-1"></a>            <span class="at">frame =</span> <span class="cn">TRUE</span>)</span>
<span id="cb30-19"><a href="#cb30-19" aria-hidden="true" tabindex="-1"></a>func_pretty <span class="ot">&lt;-</span> <span class="fu">tm_shape</span>(nga_wp26392) <span class="sc">+</span></span>
<span id="cb30-20"><a href="#cb30-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_fill</span>(<span class="st">"pct_functional"</span>,</span>
<span id="cb30-21"><a href="#cb30-21" aria-hidden="true" tabindex="-1"></a>          <span class="at">n =</span> <span class="dv">5</span>,</span>
<span id="cb30-22"><a href="#cb30-22" aria-hidden="true" tabindex="-1"></a>          <span class="at">style =</span> <span class="st">"pretty"</span>, </span>
<span id="cb30-23"><a href="#cb30-23" aria-hidden="true" tabindex="-1"></a>          <span class="at">title =</span> <span class="st">"Functional: Pretty"</span>) <span class="sc">+</span></span>
<span id="cb30-24"><a href="#cb30-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_borders</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb30-25"><a href="#cb30-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_layout</span>(<span class="at">legend.height =</span> <span class="fl">0.25</span>, </span>
<span id="cb30-26"><a href="#cb30-26" aria-hidden="true" tabindex="-1"></a>            <span class="at">legend.width =</span> <span class="fl">0.35</span>,</span>
<span id="cb30-27"><a href="#cb30-27" aria-hidden="true" tabindex="-1"></a>            <span class="at">frame =</span> <span class="cn">TRUE</span>)</span>
<span id="cb30-28"><a href="#cb30-28" aria-hidden="true" tabindex="-1"></a>func_kmeans <span class="ot">&lt;-</span> <span class="fu">tm_shape</span>(nga_wp26392) <span class="sc">+</span></span>
<span id="cb30-29"><a href="#cb30-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_fill</span>(<span class="st">"pct_functional"</span>,</span>
<span id="cb30-30"><a href="#cb30-30" aria-hidden="true" tabindex="-1"></a>          <span class="at">n =</span> <span class="dv">5</span>,</span>
<span id="cb30-31"><a href="#cb30-31" aria-hidden="true" tabindex="-1"></a>          <span class="at">style =</span> <span class="st">"kmeans"</span>, </span>
<span id="cb30-32"><a href="#cb30-32" aria-hidden="true" tabindex="-1"></a>          <span class="at">title =</span> <span class="st">"Functional: Kmeans"</span>) <span class="sc">+</span></span>
<span id="cb30-33"><a href="#cb30-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_borders</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb30-34"><a href="#cb30-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_layout</span>(<span class="at">legend.height =</span> <span class="fl">0.25</span>, </span>
<span id="cb30-35"><a href="#cb30-35" aria-hidden="true" tabindex="-1"></a>            <span class="at">legend.width =</span> <span class="fl">0.35</span>,</span>
<span id="cb30-36"><a href="#cb30-36" aria-hidden="true" tabindex="-1"></a>            <span class="at">frame =</span> <span class="cn">TRUE</span>)</span>
<span id="cb30-37"><a href="#cb30-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-38"><a href="#cb30-38" aria-hidden="true" tabindex="-1"></a><span class="fu">tmap_arrange</span>(func_quantile, func_jenks, func_pretty, func_kmeans, <span class="at">asp =</span> <span class="dv">1</span>, <span class="at">ncol =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Take-home_Ex1_files/figure-html/unnamed-chunk-25-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>The quantile plot in the top left quadrant shows that the water point proportions are somewhat normally distributed, as the bands are wider at the ends and narrower in the middle.</p>
</section>
<section id="non-functional-water-point-proportion" class="level4">
<h4 class="anchored" data-anchor-id="non-functional-water-point-proportion">Non-functional water point proportion</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>non_func_quantile <span class="ot">&lt;-</span> <span class="fu">tm_shape</span>(nga_wp26392) <span class="sc">+</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_fill</span>(<span class="st">"pct_non-functional"</span>,</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>          <span class="at">n =</span> <span class="dv">5</span>,</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>          <span class="at">style =</span> <span class="st">"quantile"</span>, </span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>          <span class="at">title =</span> <span class="st">"Non-functional: Quantile"</span>) <span class="sc">+</span></span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_borders</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_layout</span>(<span class="at">legend.height =</span> <span class="fl">0.25</span>, </span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a>            <span class="at">legend.width =</span> <span class="fl">0.35</span>,</span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a>            <span class="at">frame =</span> <span class="cn">TRUE</span>)</span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a>non_func_jenks <span class="ot">&lt;-</span> <span class="fu">tm_shape</span>(nga_wp26392) <span class="sc">+</span></span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_fill</span>(<span class="st">"pct_non-functional"</span>,</span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a>          <span class="at">n =</span> <span class="dv">5</span>,</span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a>          <span class="at">style =</span> <span class="st">"jenks"</span>, </span>
<span id="cb31-14"><a href="#cb31-14" aria-hidden="true" tabindex="-1"></a>          <span class="at">title =</span> <span class="st">"Non-functional: Jenks"</span>) <span class="sc">+</span></span>
<span id="cb31-15"><a href="#cb31-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_borders</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb31-16"><a href="#cb31-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_layout</span>(<span class="at">legend.height =</span> <span class="fl">0.25</span>, </span>
<span id="cb31-17"><a href="#cb31-17" aria-hidden="true" tabindex="-1"></a>            <span class="at">legend.width =</span> <span class="fl">0.35</span>,</span>
<span id="cb31-18"><a href="#cb31-18" aria-hidden="true" tabindex="-1"></a>            <span class="at">frame =</span> <span class="cn">TRUE</span>)</span>
<span id="cb31-19"><a href="#cb31-19" aria-hidden="true" tabindex="-1"></a>non_func_pretty <span class="ot">&lt;-</span> <span class="fu">tm_shape</span>(nga_wp26392) <span class="sc">+</span></span>
<span id="cb31-20"><a href="#cb31-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_fill</span>(<span class="st">"pct_non-functional"</span>,</span>
<span id="cb31-21"><a href="#cb31-21" aria-hidden="true" tabindex="-1"></a>          <span class="at">n =</span> <span class="dv">5</span>,</span>
<span id="cb31-22"><a href="#cb31-22" aria-hidden="true" tabindex="-1"></a>          <span class="at">style =</span> <span class="st">"pretty"</span>, </span>
<span id="cb31-23"><a href="#cb31-23" aria-hidden="true" tabindex="-1"></a>          <span class="at">title =</span> <span class="st">"Non-functional: Pretty"</span>) <span class="sc">+</span></span>
<span id="cb31-24"><a href="#cb31-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_borders</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb31-25"><a href="#cb31-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_layout</span>(<span class="at">legend.height =</span> <span class="fl">0.25</span>, </span>
<span id="cb31-26"><a href="#cb31-26" aria-hidden="true" tabindex="-1"></a>            <span class="at">legend.width =</span> <span class="fl">0.35</span>,</span>
<span id="cb31-27"><a href="#cb31-27" aria-hidden="true" tabindex="-1"></a>            <span class="at">frame =</span> <span class="cn">TRUE</span>)</span>
<span id="cb31-28"><a href="#cb31-28" aria-hidden="true" tabindex="-1"></a>non_func_kmeans <span class="ot">&lt;-</span> <span class="fu">tm_shape</span>(nga_wp26392) <span class="sc">+</span></span>
<span id="cb31-29"><a href="#cb31-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_fill</span>(<span class="st">"pct_non-functional"</span>,</span>
<span id="cb31-30"><a href="#cb31-30" aria-hidden="true" tabindex="-1"></a>          <span class="at">n =</span> <span class="dv">5</span>,</span>
<span id="cb31-31"><a href="#cb31-31" aria-hidden="true" tabindex="-1"></a>          <span class="at">style =</span> <span class="st">"kmeans"</span>, </span>
<span id="cb31-32"><a href="#cb31-32" aria-hidden="true" tabindex="-1"></a>          <span class="at">title =</span> <span class="st">"Non-functionals: Kmeans"</span>) <span class="sc">+</span></span>
<span id="cb31-33"><a href="#cb31-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_borders</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb31-34"><a href="#cb31-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_layout</span>(<span class="at">legend.height =</span> <span class="fl">0.25</span>, </span>
<span id="cb31-35"><a href="#cb31-35" aria-hidden="true" tabindex="-1"></a>            <span class="at">legend.width =</span> <span class="fl">0.35</span>,</span>
<span id="cb31-36"><a href="#cb31-36" aria-hidden="true" tabindex="-1"></a>            <span class="at">frame =</span> <span class="cn">TRUE</span>)</span>
<span id="cb31-37"><a href="#cb31-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-38"><a href="#cb31-38" aria-hidden="true" tabindex="-1"></a><span class="fu">tmap_arrange</span>(non_func_quantile, non_func_jenks, non_func_pretty, non_func_kmeans, <span class="at">asp =</span> <span class="dv">1</span>, <span class="at">ncol =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Take-home_Ex1_files/figure-html/unnamed-chunk-26-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>We see that the spatial distribution of proportion of non-functional water points is quite different, in that 80% of the LGAs have &lt;55% non-functional water points, from the quantile plot. This is consistent with what we observed in the equal interval plot using <em>qtm()</em> earlier.</p>
</section>
</section>
<section id="calculating-and-plotting-water-point-density" class="level3">
<h3 class="anchored" data-anchor-id="calculating-and-plotting-water-point-density">7.3. Calculating and Plotting Water Point Density</h3>
<p>We can calculate the density of water points in each LGA by land area, by first creating a new <code>Area</code> variable in the data frame, using <a href="https://r-spatial.github.io/sf/reference/geos_measures.html"><em>st_area()</em></a> of <strong>sf</strong> in the code chunk below. We then use <em>%&gt;%</em> and <em>mutate()</em> to create the density variables for total, functional, non-functional and unknown water points, using 1,000,000 to convert the scale from per m<sup>2</sup> to <u>per km<sup>2</sup></u>. Finally, we use <a href="https://www.rdocumentation.org/packages/base/versions/3.6.2/topics/summary"><em>summary()</em></a> of <strong>Base R</strong> to look at the summary statistics of the densities.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>nga_wp26392<span class="sc">$</span>Area <span class="ot">&lt;-</span> nga_wp26392 <span class="sc">%&gt;%</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_area</span>()</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>nga_wp26392 <span class="ot">&lt;-</span> nga_wp26392 <span class="sc">%&gt;%</span></span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="st">`</span><span class="at">total_density</span><span class="st">`</span> <span class="ot">=</span> <span class="st">`</span><span class="at">total wpt</span><span class="st">`</span> <span class="sc">/</span> Area <span class="sc">*</span> <span class="dv">1000000</span>) <span class="sc">%&gt;%</span></span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="st">`</span><span class="at">functional_density</span><span class="st">`</span> <span class="ot">=</span> <span class="st">`</span><span class="at">wpt functional</span><span class="st">`</span> <span class="sc">/</span> Area <span class="sc">*</span> <span class="dv">1000000</span>) <span class="sc">%&gt;%</span></span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="st">`</span><span class="at">non-functional_density</span><span class="st">`</span> <span class="ot">=</span> <span class="st">`</span><span class="at">wpt non-functional</span><span class="st">`</span> <span class="sc">/</span> Area <span class="sc">*</span> <span class="dv">1000000</span>) <span class="sc">%&gt;%</span></span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="st">`</span><span class="at">unknown_density</span><span class="st">`</span> <span class="ot">=</span> <span class="st">`</span><span class="at">wpt unknown</span><span class="st">`</span> <span class="sc">/</span> Area <span class="sc">*</span> <span class="dv">1000000</span>)</span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(nga_wp26392[<span class="fu">c</span>(<span class="st">"total_density"</span>, <span class="st">"functional_density"</span>, <span class="st">"non-functional_density"</span>, <span class="st">"unknown_density"</span>)])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> total_density      functional_density non-functional_density unknown_density  
 Min.   : 0.00000   Min.   : 0.00000   Min.   :0.00000        Min.   :0.00000  
 1st Qu.: 0.05131   1st Qu.: 0.02221   1st Qu.:0.01598        1st Qu.:0.00000  
 Median : 0.13951   Median : 0.05989   Median :0.04495        Median :0.00000  
 Mean   : 0.37827   Mean   : 0.21639   Mean   :0.12248        Mean   :0.03940  
 3rd Qu.: 0.38443   3rd Qu.: 0.17388   3rd Qu.:0.11509        3rd Qu.:0.04186  
 Max.   :13.51065   Max.   :10.42417   Max.   :3.95434        Max.   :0.67632  
          geometry  
 MULTIPOLYGON :774  
 epsg:26392   :  0  
 +proj=tmer...:  0  
                    
                    
                    </code></pre>
</div>
</div>
<p>We use customised plotting functions in <strong>tmap</strong> again to plot the density of the different types water points in each LGA, using the code chunk below.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>total_den <span class="ot">&lt;-</span> <span class="fu">tm_shape</span>(nga_wp26392) <span class="sc">+</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_fill</span>(<span class="st">"total_density"</span>,</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>          <span class="at">n =</span> <span class="dv">5</span>,</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>          <span class="at">style =</span> <span class="st">"equal"</span>, </span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>          <span class="at">title =</span> <span class="st">"Total Density"</span>) <span class="sc">+</span></span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_borders</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>)</span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a>wp_functional_den <span class="ot">&lt;-</span> <span class="fu">tm_shape</span>(nga_wp26392) <span class="sc">+</span></span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_fill</span>(<span class="st">"functional_density"</span>,</span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a>          <span class="at">n =</span> <span class="dv">5</span>,</span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a>          <span class="at">style =</span> <span class="st">"equal"</span>, </span>
<span id="cb34-12"><a href="#cb34-12" aria-hidden="true" tabindex="-1"></a>          <span class="at">title =</span> <span class="st">"Functional Density"</span>) <span class="sc">+</span></span>
<span id="cb34-13"><a href="#cb34-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_borders</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>)</span>
<span id="cb34-14"><a href="#cb34-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-15"><a href="#cb34-15" aria-hidden="true" tabindex="-1"></a>wp_nonfunctional_den <span class="ot">&lt;-</span> <span class="fu">tm_shape</span>(nga_wp26392) <span class="sc">+</span></span>
<span id="cb34-16"><a href="#cb34-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_fill</span>(<span class="st">"non-functional_density"</span>,</span>
<span id="cb34-17"><a href="#cb34-17" aria-hidden="true" tabindex="-1"></a>          <span class="at">n =</span> <span class="dv">5</span>,</span>
<span id="cb34-18"><a href="#cb34-18" aria-hidden="true" tabindex="-1"></a>          <span class="at">style =</span> <span class="st">"equal"</span>, </span>
<span id="cb34-19"><a href="#cb34-19" aria-hidden="true" tabindex="-1"></a>          <span class="at">title =</span> <span class="st">"Non-functional Density"</span>) <span class="sc">+</span></span>
<span id="cb34-20"><a href="#cb34-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_borders</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>)</span>
<span id="cb34-21"><a href="#cb34-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-22"><a href="#cb34-22" aria-hidden="true" tabindex="-1"></a>unknown_den <span class="ot">&lt;-</span> <span class="fu">tm_shape</span>(nga_wp26392) <span class="sc">+</span></span>
<span id="cb34-23"><a href="#cb34-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_fill</span>(<span class="st">"unknown_density"</span>,</span>
<span id="cb34-24"><a href="#cb34-24" aria-hidden="true" tabindex="-1"></a>          <span class="at">n =</span> <span class="dv">5</span>,</span>
<span id="cb34-25"><a href="#cb34-25" aria-hidden="true" tabindex="-1"></a>          <span class="at">style =</span> <span class="st">"equal"</span>, </span>
<span id="cb34-26"><a href="#cb34-26" aria-hidden="true" tabindex="-1"></a>          <span class="at">title =</span> <span class="st">"Unknown Density"</span>) <span class="sc">+</span></span>
<span id="cb34-27"><a href="#cb34-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_borders</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>)</span>
<span id="cb34-28"><a href="#cb34-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-29"><a href="#cb34-29" aria-hidden="true" tabindex="-1"></a><span class="fu">tmap_arrange</span>(total_den, wp_functional_den, wp_nonfunctional_den, unknown_den, <span class="at">asp=</span><span class="dv">1</span>, <span class="at">ncol=</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Take-home_Ex1_files/figure-html/unnamed-chunk-28-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>We see that most LGAs have similar in density in the lowest quantile, except for a handful of smaller LGAs such as Kano Municipal (13.5 total water points/km<sup>2</sup>), Dala (10.3 total water points/km<sup>2</sup>) and Ibadan North East (9.5 total water points/km<sup>2</sup>). In terms of the density of non-functional water points, with reference to the plot in the bottom left quadrant, it is most prominent in a similar pool of LGAs such as Dala (4.0 water points/km<sup>2</sup>), Ibadan North East (3.4 water points/km<sup>2</sup>) and Kano Municipal (3.1 water points/km<sup>2</sup>), due to the small area.</p>
<p>As the water point density is roughly equally distributed, we can use <u>proportion</u> instead of absolute number of non-functional water points in our subsequent analysis on global and local spatial association. This approach will help us better determine LGAs that have higher proportions of non-functional water points which may suggest a more detailed investigation to be done to address any possible underlying reasons.</p>
</section>
</section>
<section id="analytical-mapping---overview" class="level2">
<h2 class="anchored" data-anchor-id="analytical-mapping---overview">8. Analytical Mapping - Overview</h2>
<p>In this section, we want to conduct spatial autocorrelation analysis to statistically answer questions such as on spatial distribution, clustering and outliers of the water point data in Nigeria, as a form of Confirmatory Data Analysis (CDA). The concepts of spatial autocorrelation are built upon Tobler’s First Law of Geography, which states that “Everything is related to everything else, but near things are more related than distant things.” (Tobler, 1970).</p>
<p>We will perform global spatial correlation to answer the high level question on whether the spatial distribution of non-functional water points is random (vis-à-vis having a certain pattern, be it positive or negative correlation between neighbouring regions or having outliers). This requires us to first construct spatial weights of the study area to define the neighbouring relationships between the LGAs, followed by conducting Global Moran’s I and Geary’s C statistical testing. Should there be any pattern discovered, we will perform cluster and outlier analysis using Local Moran’s I testing and Local Indicator of Spatial Association (LISA). Finally, we will conduct hot spot and cold spot area analysis and compute the Gi statistics.</p>
</section>
<section id="computing-contiguity-spatial-weights" class="level2">
<h2 class="anchored" data-anchor-id="computing-contiguity-spatial-weights">9. Computing Contiguity Spatial Weights</h2>
<p>There are 2 main methods of defining spatial weights:</p>
<ol type="1">
<li>Contiguity method (also known as adjacency method, based on shared boundaries);
<ol type="1">
<li><p>Queen’s criteria;</p></li>
<li><p>Rook’s criteria; and</p></li>
</ol></li>
<li>Distance method (based on distance between centroids);
<ol type="1">
<li><p>Fixed weighting scheme (neighbours are those within a fixed distance or bandwidth to the centroid);</p></li>
<li><p>Adaptive weighting scheme (neighbours defined by each region having k neighbours that are nearest to it, distance or bandwidth from each region is different);</p></li>
<li><p>Inverse distance (1/dist formula where closer neighbours have larger inverse distance value which is between 0 and 1).</p></li>
</ol></li>
</ol>
<p>We will explore these methods and determine an appropriate one for further analysis of spatial association.</p>
<section id="computing-queens-contiguity-based-neighbours" class="level3">
<h3 class="anchored" data-anchor-id="computing-queens-contiguity-based-neighbours">9.1. Computing Queen’s Contiguity-based Neighbours</h3>
<p>In the code chunk below, <a href="https://r-spatial.github.io/spdep/reference/poly2nb.html"><em>poly2nb()</em></a> of <strong>spdep</strong> is used to compute the contiguity weight matrix for the study area. This function builds a neighbours list based on regions with contiguous boundaries. The default option uses the Queen’s criteria to define each LGA’s neighbours (<code>queen = TRUE</code>), which is what we will use here. We will explore Rook’s criteria in the subsequent sub-section. A visual representation of the contiguity criteria is shown in the figure below.</p>
<p><img src="images/paste-BC6BD08B.png" class="img-fluid"></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>wm_q <span class="ot">&lt;-</span> <span class="fu">poly2nb</span>(nga_wp26392)</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(wm_q)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Neighbour list object:
Number of regions: 774 
Number of nonzero links: 4440 
Percentage nonzero weights: 0.7411414 
Average number of links: 5.736434 
1 region with no links:
86
Link number distribution:

  0   1   2   3   4   5   6   7   8   9  10  11  12  14 
  1   2  14  57 125 182 140 122  72  41  12   4   1   1 
2 least connected regions:
138 560 with 1 link
1 most connected region:
508 with 14 links</code></pre>
</div>
</div>
<p>There are a total of 4,440 pairs of neighbours between the Nigeria LGAs based on Queen’s definition of neighbours where there must at least 1 shared boundary point between neighbours. Most LGAs have between 3 and 9 neighbours. There is 1 LGA that has 0 neighbour which we should look into. There are also up to 14 neighbours for another LGA (polygon ID 508), possibly a large area surrounded by multiple smaller regions.</p>
<p>We can look at the complete contiguity weight matrix using <em>str()</em> of <strong>utils</strong> in the code chunk below.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(wm_q)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Opening <code>wm_q</code> in the R environment, we see that polygon ID 86 has value 0 for its neighbours. We look at the names of the LGAs of polygon ID 86 (least neighbours) and 508 (most neighbours) using the code chunk below.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>nga_wp26392<span class="sc">$</span>shapeName[<span class="fu">c</span>(<span class="dv">86</span>, <span class="dv">508</span>)]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Bakassi" "Mokwa"  </code></pre>
</div>
</div>
<p>The LGA with no neighbour is Bakassi, and that with the most number of neighbours (14) is Mokwa.</p>
<p>Plotting the Nigeria LGAs using <em>tm_shape()</em>, <a href="https://search.r-project.org/CRAN/refmans/tmap/html/tm_polygons.html"><em>tm_polygons()</em></a> and <em>tm_text()</em> of <strong>tmap</strong>, we could visualise the polygons representing the LGAs (<em>tm_polygons()</em> fills the polygons and draws the polygon borders) with text displaying the name of each LGA within. A close-up screenshot of the Bakassi LGA is shown below. It has 0 neighbours by contiguity method as it does not share its borders with any other Nigeria LGAs, and is separated from its closest LGA, Akpabuyo, by the Atlantic Ocean. In fact, since 2008, Bakassi Penisula was transferred from Nigerian control to that of Cameroon, under the Greentree Agreement (Library of Congress, 2013).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(nga_wp26392) <span class="sc">+</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_polygons</span>() <span class="sc">+</span></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_text</span>(<span class="st">"shapeName"</span>, <span class="at">size =</span> <span class="fl">1.2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><img src="images/paste-D76B9EB2.png" class="img-fluid"></p>
<p>We can also further look at the neighbours of Mokwa using the code chunk below.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>nb508 <span class="ot">&lt;-</span> wm_q[[<span class="dv">508</span>]]</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>nb508 <span class="ot">&lt;-</span> nga_wp26392<span class="sc">$</span>shapeName[nb508]</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>nb508</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "Agaie"    "Bida"     "Borgu"    "Edati"    "Edu"      "Gbako"   
 [7] "Kaiama"   "Katcha"   "Lavun"    "Lokoja"   "Mashegu"  "Moro"    
[13] "Pategi"   "Wushishi"</code></pre>
</div>
</div>
<p>We can also display the structure of the distance-bsaed weights matrix by using <a href="https://www.rdocumentation.org/packages/base/versions/3.6.2/topics/table"><em>table()</em></a> of <strong>Base R</strong> and <a href="https://r-spatial.github.io/spdep/reference/card.html"><em>card()</em></a> of <strong>spdep</strong>. The latter tallies the numbers of neighbours of regions in the neighbours list, and feeds into the former to build a contingency table where each row is an LGA (alphabetically ordered) and “1” is indicated for the number of neighbours that it has (columns). We use <em>head()</em> of <strong>utils</strong> to limit the output to the first 6 rows.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(<span class="fu">table</span>(nga_wp26392<span class="sc">$</span>shapeName, <span class="fu">card</span>(wm_q)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>           
            0 1 2 3 4 5 6 7 8 9 10 11 12 14
  Aba North 0 0 0 0 1 0 0 0 0 0  0  0  0  0
  Aba South 0 0 0 1 0 0 0 0 0 0  0  0  0  0
  Abadam    0 0 0 1 0 0 0 0 0 0  0  0  0  0
  Abaji     0 0 0 0 0 0 0 1 0 0  0  0  0  0
  Abak      0 0 0 0 0 1 0 0 0 0  0  0  0  0
  Abakaliki 0 0 0 0 0 0 0 1 0 0  0  0  0  0</code></pre>
</div>
</div>
<p>We use <a href="https://r-spatial.github.io/spdep/reference/compon.html"><em>n.comp.nb()</em></a> of <strong>spdep</strong> to perform depth first search on neighbours list and confirm that all regions are neighbours to each other (i.e.&nbsp;within a single neighbours list). If any of the regions are disjoint, they will be indicated by a 2nd region etc.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>n_comp_q <span class="ot">&lt;-</span> <span class="fu">n.comp.nb</span>(wm_q)</span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(n_comp_q<span class="sc">$</span>comp.id)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
  1   2 
773   1 </code></pre>
</div>
</div>
<p>In this case, we see that 1 LGA is separate from the rest of the LGAs. This is the LGA which has no neighbour.</p>
</section>
<section id="computing-rooks-contiguity-based-neighbours" class="level3">
<h3 class="anchored" data-anchor-id="computing-rooks-contiguity-based-neighbours">9.2. Computing Rook’s Contiguity-based Neighbours</h3>
<p>We repeat the process of deriving contiguity weight matrix, using Rook’s criteria, using the <code>queen = FALSE</code> argument in the code chunk below.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>wm_r <span class="ot">&lt;-</span> <span class="fu">poly2nb</span>(nga_wp26392, <span class="at">queen =</span> <span class="cn">FALSE</span>)</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(wm_r)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Neighbour list object:
Number of regions: 774 
Number of nonzero links: 4420 
Percentage nonzero weights: 0.7378029 
Average number of links: 5.710594 
1 region with no links:
86
Link number distribution:

  0   1   2   3   4   5   6   7   8   9  10  11  12  14 
  1   2  14  59 127 181 141 124  66  42  11   4   1   1 
2 least connected regions:
138 560 with 1 link
1 most connected region:
508 with 14 links</code></pre>
</div>
</div>
<p>There are a total of 4,420 pairs of neighbours between the Nigeria LGAs based on Rook’s definition of neighbours where there must more than 1 shared boundary point between neighbours. The minimum and maximum numbers of neighbours remain unchanged compared to Queen’s criteria.</p>
<p>We can similarly look at the complete contiguity weight matrix using <em>str()</em> of <strong>utils</strong> in the code chunk below.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(wm_r)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Conducting the depth first search analysis on the neighbours list by Rook’s criteria, we find the same result that only 1 LGA is disjoint from the remaining LGAs.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>n_comp_r <span class="ot">&lt;-</span> <span class="fu">n.comp.nb</span>(wm_r)</span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(n_comp_r<span class="sc">$</span>comp.id)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
  1   2 
773   1 </code></pre>
</div>
</div>
</section>
<section id="visualising-contiguity-based-neighbours" class="level3">
<h3 class="anchored" data-anchor-id="visualising-contiguity-based-neighbours">9.3. Visualising Contiguity-based Neighbours</h3>
<p>A connectivity graph takes a point and displays a line between each pairs of neighbouring points. For this exercise, we need to obtain the points from the polygon geometry data. The most common method used is to obtain the polygon centroids, which we will do using the <strong>sf</strong> package.</p>
<p>As we have earlier projected the data from <strong>wgs84</strong> geographical CRS to <strong>Minna / Nigeria Mid Belt</strong> projected CRS, we can use <a href="https://r-spatial.github.io/sf/reference/geos_unary.html"><em>st_centroid()</em></a> of <strong>sf</strong> to find the centroids of each polygon in <strong>point</strong> format. We then extract and store the longitude and latitude of the points in <code>coords</code> matrix using <a href="https://www.rdocumentation.org/packages/sf/versions/1.0-9/topics/st_coordinates"><em>st_coordinates()</em></a> of <strong>sf</strong>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>coords <span class="ot">&lt;-</span> <span class="fu">st_coordinates</span>(<span class="fu">st_centroid</span>(<span class="fu">st_geometry</span>(nga_wp26392)))</span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(coords)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>          X         Y
1  545623.9  123092.0
2  543365.1  119791.0
3 1193361.8 1047639.4
4  488844.6  533852.2
5  589858.3  112961.1
6  639608.2  249771.0</code></pre>
</div>
</div>
<p>We can plot the Queen’s and Rook’s contiguity-based neighbours map. <a href="https://www.rdocumentation.org/packages/graphics/versions/3.6.2/topics/par"><em>par()</em></a> is used to set the parameters for the plots, having the plots in 1 row, 2 columns using the <code>mfrow</code> argument. We set the mode to <code>"plot"</code> for static plot to reduce the memory required to render the html file, as we do not require the rest of the plots to be interactive.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tmap_mode</span>(<span class="st">"plot"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>))</span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(nga_wp26392<span class="sc">$</span>geometry, <span class="at">border =</span> <span class="st">"lightgrey"</span>)</span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(wm_q, coords, <span class="at">pch =</span> <span class="dv">19</span>, <span class="at">cex =</span> <span class="fl">0.6</span>, <span class="at">add =</span> <span class="cn">TRUE</span>, <span class="at">col =</span> <span class="st">"red"</span>, <span class="at">main =</span> <span class="st">"Queen's Contiguity"</span>)</span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(nga_wp26392<span class="sc">$</span>geometry, <span class="at">border =</span> <span class="st">"lightgrey"</span>)</span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(wm_r, coords, <span class="at">pch =</span> <span class="dv">19</span>, <span class="at">cex =</span> <span class="fl">0.6</span>, <span class="at">add =</span> <span class="cn">TRUE</span>, <span class="at">col =</span> <span class="st">"red"</span>, <span class="at">main =</span> <span class="st">"Rook's Contiguity"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Take-home_Ex1_files/figure-html/unnamed-chunk-41-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="row-standardised-queens-contiguity-weight-matrix" class="level3">
<h3 class="anchored" data-anchor-id="row-standardised-queens-contiguity-weight-matrix">9.4. Row-standardised Queen’s Contiguity Weight Matrix</h3>
<p>As the neighbours lists from Queen’s and Rook’s contiguity methods are similar, and we do not have a good reason to use &gt;1 shared boundary points as the cutoff criteria (e.g.&nbsp;LGAs with just 2 shared boundary points would be considered neighbours by Rook’s criteria but not Queen’s), we will use Queen’s contiguity-based neighbours to compute the contiguity weight matrix.</p>
<p>In the contiguity weight matrix, we assign a spatial weight to each pairs of LGAs in. Each row and each column represent 1 of the 774 LGAs, forming a 774 x 774 matrix. The numbers 1 and 0 are used to indicate between each row and column pair (e.g.&nbsp;neighbour pair 1-2 represented by the value in the first row and second column), whether they are neighbours (1) or not (0). The values along the diagonal (from top left to bottom right) is always 0 as they represent the same region (e.g.&nbsp;1-1, 2-2, etc.) Such a matrix is symmetrical along the same diagonal.</p>
<p>As each region has different number of neighbours, in practice, row-standardised weights are used instead of spatial weights. Row-standardisation is done by dividing the values in each row by the sum of that row, so that the weight is a relative fraction based on the total number of neighbours that the region has (proportion by row sum). Row-standardisation weights matrix ensures that the spatial parameter in many spatial stochastic processes are comparable between models. It is applicable where polygon features are defined by administrative boundaries (ArcGIS Desktop, 2021). While this is the most intuitive way of summarising the neighbours’ values, this approach has a limitation in that polygons along the edges of the study area will base their lagged values on fewer polygons, thus potentially over- or under-estimating the true nature of the spatial correlation in the data. More robust options such as the binary coding could be explored, such as in inverse distance weight (IDW) method.</p>
<p>The code chunk below performs row standardisation for spatial weights using the <a href="https://www.rdocumentation.org/packages/spdep/versions/1.2-7/topics/nb2listw"><em>nb2listw()</em></a> of <strong>spdep</strong>, with input being <code>wm_q</code> which is an object of class <strong>nb</strong>. The default style is “W” which is row standardisation. Other styles include “B” for basic binary coding, “C” for globally standaridsation, “U” for C divided by the number of neighbours, and “S” for variance-stablising coding scheme. Here, we use the default <code>style = "W"</code> to derive the weight matrix with row standardisation, to align the basis for analysis whether the LGA has many or few neighbours. For the zero.policy, we will set it to TRUE to permit the weights list to be formed with zero-length weights vector, which means that weights vector of zero length are inserted for LGAs without neighbour in the neighbours list, which we saw for Bakassi in the previous sub-section.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.ZeroPolicyOption</span>(<span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] FALSE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>rswm_q <span class="ot">&lt;-</span> <span class="fu">nb2listw</span>(wm_q,</span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>                   <span class="at">style =</span> <span class="st">"W"</span>,</span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">zero.policy =</span> <span class="cn">TRUE</span>)</span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a>rswm_q</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Characteristics of weights list object:
Neighbour list object:
Number of regions: 774 
Number of nonzero links: 4440 
Percentage nonzero weights: 0.7411414 
Average number of links: 5.736434 
1 region with no links:
86

Weights style: W 
Weights constants summary:
    n     nn  S0       S1       S2
W 773 597529 773 285.0658 3198.414</code></pre>
</div>
</div>
</section>
<section id="computing-fixed-distance-based-neighbours" class="level3">
<h3 class="anchored" data-anchor-id="computing-fixed-distance-based-neighbours">9.5. Computing Fixed Distance-based Neighbours</h3>
<p>Another way to define neighbour relationship is to used distance-based matrix. Using <a href="https://r-spatial.github.io/spdep/reference/dnearneigh.html"><em>dnearneigh()</em></a> of <strong>spdep</strong>, neighbours of an LGA are determined based on the Euclidean distance with a distance band with lower <code>d1=</code> and upper <code>d2=</code> bounds controlled by the <code>bounds=</code> argument. As we have projected the data to projected CRS, we will set <code>longlat = FALSE</code>. Circle distances in m will be calculated.</p>
</section>
<section id="determining-the-cut-off-distance" class="level3">
<h3 class="anchored" data-anchor-id="determining-the-cut-off-distance">Determining the Cut-off Distance</h3>
<p>First, we need to determine the upper limit for distance band by using the following steps:</p>
<ol type="1">
<li><p>Return a matrix with the indices of points belonging to the set of the k nearest neighbours of each other using <a href="https://r-spatial.github.io/spdep/reference/knearneigh.html"><em>knearneigh()</em></a> of <strong>spdep</strong>.</p></li>
<li><p>Convert the knn object returned by <em>knearneigh()</em> into a neighbours list of class nb with a list of integer vectors containing neighbour region number IDs by using <a href="https://r-spatial.github.io/spdep/reference/knn2nb.html"><em>knn2nb()</em></a>.</p></li>
<li><p>Return the length of neighbour relationship edges by using <a href="https://r-spatial.github.io/spdep/reference/nbdists.html"><em>nbdists()</em></a> of <strong>spdep</strong>. This function returns in the units of the coordinates if the coordinates are projected, and in km otherwise. Here, the unit used by projected CRS for Minna / Nigeria Mid Belt is m.</p></li>
<li><p>Remove the list structure of the returned object using <a href="https://www.rdocumentation.org/packages/base/versions/3.6.2/topics/unlist"><em>unlist()</em></a>.</p></li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>k1 <span class="ot">&lt;-</span> <span class="fu">knn2nb</span>(<span class="fu">knearneigh</span>(coords))</span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>k1dists <span class="ot">&lt;-</span> <span class="fu">unlist</span>(<span class="fu">nbdists</span>(k1, coords, <span class="at">longlat =</span> <span class="cn">FALSE</span>))</span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(k1dists)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
   2663   12812   20237   22050   27702   71724 </code></pre>
</div>
</div>
<p>The summary report shows that the largest first nearest neighbour distance is 71,724 m. We can use 71,730 m as the upper threshold to ensure that all regions will at least have 1 neighbour.</p>
</section>
<section id="computing-fixed-distance-weights-matrix" class="level3">
<h3 class="anchored" data-anchor-id="computing-fixed-distance-weights-matrix">Computing Fixed-Distance Weights Matrix</h3>
<p>Using 71,730 m as the upper bound and 0 km as a lower bound (i.e.&nbsp;all regions with centroids within 71,730 m distance of a particular LGA will be considered its neighbours), we compute the distance weights matrix using <a href="https://r-spatial.github.io/spdep/reference/dnearneigh.html"><em>dnearneigh()</em></a> of <strong>spdep</strong>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>wm_d71 <span class="ot">&lt;-</span> <span class="fu">dnearneigh</span>(coords, <span class="dv">0</span>, <span class="dv">71730</span>, <span class="at">longlat =</span> <span class="cn">FALSE</span>)</span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>wm_d71</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Neighbour list object:
Number of regions: 774 
Number of nonzero links: 17986 
Percentage nonzero weights: 3.00229 
Average number of links: 23.23773 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(wm_d71)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Neighbour list object:
Number of regions: 774 
Number of nonzero links: 17986 
Percentage nonzero weights: 3.00229 
Average number of links: 23.23773 
Link number distribution:

 1  2  3  4  5  6  7  8  9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 
 5  9 11 22 33 34 33 37 27 34 28 23 17 23 14 14 12 16 11 18 16 13 10 10  6 14 
27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 
 9  6 17 12 13  7  7 10 10  8 13 14 14 11 10  3  2  7  6  7  9  8  4  6  2  3 
53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 69 
 2  4  5  6  7  1  3  6  6  8  7  3  3  1  3  1 
5 least connected regions:
90 112 123 237 670 with 1 link
1 most connected region:
585 with 69 links</code></pre>
</div>
</div>
<p>For the 774 LGAs in Nigeria, there are a total of 17,986 links (neighbour-neighbour pairs) which are 71,730 m or less between each other, averaging to 23.2 neighbours per LGA.</p>
<p>Based on the summary report, there are 5 LGAs with only 1 neighbour each. The most connected region has 69 neighbours within the 71,730 m radius, and it is polygon ID 585 (Okigwe), as seen using the code chunk below.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a>nga_wp26392<span class="sc">$</span>shapeName[[<span class="dv">585</span>]]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Okigwe"</code></pre>
</div>
</div>
<p>To look at the number of neighbours for each LGA and their polygon IDs, we can use the <em>str()</em> function of R’s <strong>utils</strong> package to see its internal structure.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(wm_d71)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Similar to earlier, we can use <em>n.comp.nb()</em> of <strong>spdep</strong> to perform depth first search on neighbours list and confirm that all LGAs are neighbours to each other (i.e.&nbsp;within a single neighbours list). If any of the LGAs are disjoint, they will be indicated by a second, third, etc. column.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>n_comp <span class="ot">&lt;-</span> <span class="fu">n.comp.nb</span>(wm_d71)</span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(n_comp<span class="sc">$</span>comp.id)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
  1   2 
772   2 </code></pre>
</div>
</div>
<p>We see that there are 2 LGAs which are not connected as neighbours to the remaining 772 LGAs.</p>
</section>
<section id="plotting-fixed-distance-weight-matrix" class="level3">
<h3 class="anchored" data-anchor-id="plotting-fixed-distance-weight-matrix">9.6. Plotting Fixed Distance Weight Matrix</h3>
<p>Plotting <code>wm_d71</code> using <a href="https://www.rdocumentation.org/packages/graphics/versions/3.6.2/topics/plot"><em>plot()</em></a> of <strong>R graphics</strong> shows us the neighbour relationship in map form, and <a href="https://www.rdocumentation.org/packages/graphics/versions/3.6.2/topics/points"><em>points()</em></a> of <strong>R graphics</strong> can show us disjoint neighbours lists in different colours.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(nga_wp26392<span class="sc">$</span>geometry, <span class="at">border =</span> <span class="st">"lightgrey"</span>)</span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(wm_d71, coords, <span class="at">add =</span> <span class="cn">TRUE</span>)</span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(coords, <span class="at">col =</span> n_comp<span class="sc">$</span>comp.id, <span class="at">pch =</span> <span class="dv">19</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Take-home_Ex1_files/figure-html/unnamed-chunk-48-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Based on the plot, we see the 2 separate neighbour list plotted as pink points to the East of Nigeria. They are Bali and Gassol. They are relatively large LGAs which are surrounded by medium size LGAs, and are only neighbours to each other within the 71,730 m radius.</p>
<p>We also see that there are 3 broad areas in the extreme North, extreme South and Southwest part of Nigeria which are very dense in the neighbours link. These areas are relatively dense in smaller LGAs, hence each LGA is likely to have more neighbours, compared to the rest parts of the country.</p>
<p>If we want to visualise the links of 1<sup>st</sup> nearest neighbours only and compare that to all neighbour links, we can use the code chunk below. It plots <code>k1</code> for 1<sup>st</sup> nearest neighbour links on the left and all neighbours based on 71,730 m distance threshold on the right. Both maps are underlain using the polygon geometries of <code>nga_wp26392</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>))</span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(nga_wp26392<span class="sc">$</span>geometry, <span class="at">border =</span> <span class="st">"lightgrey"</span>)</span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(k1, coords, <span class="at">add =</span> <span class="cn">TRUE</span>, <span class="at">col =</span> <span class="st">"red"</span>, <span class="at">length =</span> <span class="fl">0.08</span>, <span class="at">main =</span> <span class="st">"1st nearest neighbours"</span>)</span>
<span id="cb72-4"><a href="#cb72-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(nga_wp26392<span class="sc">$</span>geometry, <span class="at">border =</span> <span class="st">"lightgrey"</span>)</span>
<span id="cb72-5"><a href="#cb72-5" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(wm_d71, coords, <span class="at">add =</span> <span class="cn">TRUE</span>, <span class="at">pch =</span> <span class="dv">19</span>, <span class="at">cex =</span> <span class="fl">0.6</span>, <span class="at">main =</span> <span class="st">"Distance link"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Take-home_Ex1_files/figure-html/unnamed-chunk-49-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>We notice that the density of 1<sup>st</sup> links is similar to that of all neighbours within 71,730 m radius, where the top, bottom and bottom left regions are the most dense with neighbour links.</p>
<p>Using <em>nb2list()</em> of <strong>spdep</strong>, we can assign the fixed distance-based weights matrix based on binary logic (<code>style = "B"</code>), in the code chunk below.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a>wm71_lw <span class="ot">&lt;-</span> <span class="fu">nb2listw</span>(wm_d71,</span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a>                   <span class="at">style =</span> <span class="st">"B"</span>, </span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">zero.policy =</span> <span class="cn">TRUE</span>)</span>
<span id="cb73-4"><a href="#cb73-4" aria-hidden="true" tabindex="-1"></a>wm71_lw</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Characteristics of weights list object:
Neighbour list object:
Number of regions: 774 
Number of nonzero links: 17986 
Percentage nonzero weights: 3.00229 
Average number of links: 23.23773 

Weights style: B 
Weights constants summary:
    n     nn    S0    S1      S2
B 774 599076 17986 35972 2581680</code></pre>
</div>
</div>
</section>
<section id="computing-adaptive-distance-weight-matrix" class="level3">
<h3 class="anchored" data-anchor-id="computing-adaptive-distance-weight-matrix">9.7. Computing Adaptive Distance Weight Matrix</h3>
<p>One of the characteristics of fixed distance weights matrix is that more densely settled areas (usually urban areas) tend to have more neighbours while less densely settled areas (usually rural areas) tend to have less neighbours. Having many neighbours smooths the neighbour relationship across more neighbours, resulting in “unfair” spatial association analysis between LGAs with more versus less neighbours within a fixed distance radius.</p>
<p>We can control the number of neighbours that each region has, by using k-nearest neighbours instead of stipulating a fixed distance threshold for neighbour-neighbour relationship, either accepting asymmetric neighbours or imposing symmetry, using <em>knn2nb()</em> and <em>knearneigh()</em> combination in the code chunk below. This is similar to how we determined the largest distance for 1st neighbour pairs in order to come up with the fixed distance weights matrix, except without needing to compute the distances between each pair.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>knn8 <span class="ot">&lt;-</span> <span class="fu">knn2nb</span>(<span class="fu">knearneigh</span>(coords, <span class="at">k =</span> <span class="dv">8</span>))</span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a>knn8</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Neighbour list object:
Number of regions: 774 
Number of nonzero links: 6192 
Percentage nonzero weights: 1.033592 
Average number of links: 8 
Non-symmetric neighbours list</code></pre>
</div>
</div>
<p>We see that by setting <code>k = 8</code> so that each region has exactly 8 neighbours, we get a total of 774 * 8 = 6,192 links.</p>
<p>We can similarly display the content of the matrix using <em>str()</em> of R’s <strong>utils</strong> to see the region IDs of all 8 neighbours for each region.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(knn8)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The code chunk below uses <em>n.comp.nb()</em> of <strong>spdep</strong> to perform depth first search on neighbours list and confirm that all LGAs are neighbours to each other (i.e.&nbsp;within a single neighbours list). If any of the LGAs are disjoint, they will be indicated by a second, third, etc. column.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a>n_comp <span class="ot">&lt;-</span> <span class="fu">n.comp.nb</span>(knn8)</span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(n_comp<span class="sc">$</span>comp.id)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
  1 
774 </code></pre>
</div>
</div>
<p>We see that there are all 774 LGAs are connected within a single neighbours list. This contrasts the fixed distance method using 71,730 m as the upper threshold. This is because by increasing the number of neighbour that each LGA has to exactly 8, it increases the chances of them being all inter-connected in one way or another. For example, Bali and Gassol, which are only neighbours to each other under the fixed distance method, are now neighbours to other LGAs which are in turn connected to the rest of the LGAs in a single neighbours list.</p>
<p>Using <em>nb2list()</em> of <strong>spdep</strong>, we can assign the adaptive distance-based weights matrix based on binary logic (<code>style = "B"</code>), which works the same as the row-standardised option (<code>style = "W"</code>), as the number of neighbours that each LGA has is exactly the same (8 neighbours each). However, for ease of interpretation, we will use “W” style as the weighted sum of the proportion of non-functional water points can be interpreted against a scale of 0-1, since each neighbour contributes 12.5% weightage to the proportion.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a>rswm_knn8 <span class="ot">&lt;-</span> <span class="fu">nb2listw</span>(knn8,</span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a>                      <span class="at">style =</span> <span class="st">"W"</span>, </span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a>                      <span class="at">zero.policy =</span> <span class="cn">TRUE</span>)</span>
<span id="cb80-4"><a href="#cb80-4" aria-hidden="true" tabindex="-1"></a>rswm_knn8</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Characteristics of weights list object:
Neighbour list object:
Number of regions: 774 
Number of nonzero links: 6192 
Percentage nonzero weights: 1.033592 
Average number of links: 8 
Non-symmetric neighbours list

Weights style: W 
Weights constants summary:
    n     nn  S0     S1       S2
W 774 599076 774 174.25 3155.344</code></pre>
</div>
</div>
<p>In the code chunk below, we use the variable <code>weights</code> of matrix <code>rswm_knn8</code> to check that the weights have been standardised to 1/8 (0.125) for each of the 8 neighbours for each LGA. We check using the <em>head()</em> function of <strong>utils</strong> to reveal the weights for the first 6 observations.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(rswm_knn8<span class="sc">$</span>weights)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[[1]]
[1] 0.125 0.125 0.125 0.125 0.125 0.125 0.125 0.125

[[2]]
[1] 0.125 0.125 0.125 0.125 0.125 0.125 0.125 0.125

[[3]]
[1] 0.125 0.125 0.125 0.125 0.125 0.125 0.125 0.125

[[4]]
[1] 0.125 0.125 0.125 0.125 0.125 0.125 0.125 0.125

[[5]]
[1] 0.125 0.125 0.125 0.125 0.125 0.125 0.125 0.125

[[6]]
[1] 0.125 0.125 0.125 0.125 0.125 0.125 0.125 0.125</code></pre>
</div>
</div>
</section>
<section id="plotting-adaptive-distance-based-neighbours" class="level3">
<h3 class="anchored" data-anchor-id="plotting-adaptive-distance-based-neighbours">9.8. Plotting Adaptive Distance-based Neighbours</h3>
<p>We plot the adaptive distance weights matrix using the code chunk below. <em>plot()</em> of <strong>R graphics</strong> is used to plot the LGA polygons by their borders using <code>nga_wp26392$geometry</code>, with a second plot of <code>knn8</code> layered on to show the neighbour-neighbour relationship. <code>pch = 19</code> is the argument for the point size of the centroid of each LGA, given by the coords. <code>col = "red"</code> defines the colour of the neighbour-neighbour relationship displayed.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(nga_wp26392<span class="sc">$</span>geometry, <span class="at">border =</span> <span class="st">"lightgrey"</span>)</span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(knn8, coords, <span class="at">pch =</span> <span class="dv">19</span>, <span class="at">cex =</span> <span class="fl">0.6</span>, <span class="at">add =</span> <span class="cn">TRUE</span>, <span class="at">col =</span> <span class="st">"red"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Take-home_Ex1_files/figure-html/unnamed-chunk-56-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>We observe that while the densest regions are still in the North, South and Northwest, it is much less compared to that in the fixed distance method. This is because the number of neighbours of each LGA is fixed at 8, resulting in a total of 6,192 neighbour links, which is just about 1/3 of the 17,986 links from the fixed distance method at 71,730 m cutoff.</p>
</section>
<section id="computing-inverse-distance-weight-idw-matrix" class="level3">
<h3 class="anchored" data-anchor-id="computing-inverse-distance-weight-idw-matrix">9.9. Computing Inverse Distance Weight (IDW) Matrix</h3>
<p>We can also derive spatial weight matrix based on inverse distance method.</p>
<p>The code chunk below computes the distance between areas by using <em>nbdists()</em> of <strong>spdep</strong>, similar to how we computed the distances between 1st neighbour pairs in the fixed distance weights matrix approach. We then use <a href="https://www.rdocumentation.org/packages/base/versions/3.6.2/topics/lapply"><em>lapply()</em></a> of <strong>base R</strong> to apply the function to inverse the distance computed (1/dist). Here, we use <code>wm_q</code>, which defines neighbouring relationship using Queen’s contiguity method, as a basis for neighbour links. We read the first 6 observations of the <code>ids</code> object using <em>head()</em> of <strong>utils</strong> as the full output list of IDW for 774 LGAs is too long.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a>dist <span class="ot">&lt;-</span> <span class="fu">nbdists</span>(wm_q, coords, <span class="at">longlat =</span> <span class="cn">FALSE</span>)</span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a>ids <span class="ot">&lt;-</span> <span class="fu">lapply</span>(dist, <span class="cf">function</span>(x) <span class="dv">1</span><span class="sc">/</span>(x))</span>
<span id="cb85-3"><a href="#cb85-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(ids)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[[1]]
[1] 2.500091e-04 9.047885e-05 1.074832e-04 9.376298e-05

[[2]]
[1] 2.500091e-04 8.863439e-05 1.410608e-04

[[3]]
[1] 1.584784e-05 1.656692e-05 1.257362e-05

[[4]]
[1] 1.716918e-05 3.003258e-05 1.330532e-05 2.169091e-05 5.979524e-05
[6] 4.456967e-05 1.353021e-05

[[5]]
[1] 5.994962e-05 5.404533e-05 4.763619e-05 3.801725e-05 6.151752e-05

[[6]]
[1] 3.032934e-05 3.666317e-05 3.520442e-05 5.109169e-05 3.849929e-05
[6] 2.871852e-05 1.682539e-05</code></pre>
</div>
</div>
<p>We see that the inverse distance values are small (on the scale of 0.0001), as the distance is in m and are very large for each LGA.</p>
<p>Using <em>nb2listw()</em> of <strong>spdep</strong> and arguments <code>glist = ids</code> and <code>style = "B"</code> so that each neighbour link is assigned the weight that is equal to the inverse distance calculated, we derive the IDW matrix via the code chunk below.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a>rswm_ids <span class="ot">&lt;-</span> <span class="fu">nb2listw</span>(wm_q, <span class="at">glist =</span> ids, <span class="at">style =</span> <span class="st">"B"</span>, <span class="at">zero.policy =</span> <span class="cn">TRUE</span>)</span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a>rswm_ids</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Characteristics of weights list object:
Neighbour list object:
Number of regions: 774 
Number of nonzero links: 4440 
Percentage nonzero weights: 0.7411414 
Average number of links: 5.736434 
1 region with no links:
86

Weights style: B 
Weights constants summary:
    n     nn        S0           S1           S2
B 773 597529 0.1822073 2.605823e-05 0.0002517888</code></pre>
</div>
</div>
<p>The weights assigned to each neighbour is no longer uniform across neighbours for the same region, but are standardised based on the inverse of the distance between the centroids of the region and each neighbour. We use <em>summary()</em> and <em>unlist()</em> of <strong>base R</strong> for the summary statistics of the weights by IDW method using the code chunk below.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(<span class="fu">unlist</span>(rswm_ids<span class="sc">$</span>weights))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     Min.   1st Qu.    Median      Mean   3rd Qu.      Max. 
5.360e-06 2.051e-05 3.156e-05 4.104e-05 4.825e-05 3.756e-04 </code></pre>
</div>
</div>
<p>The minimum, maximum, mean, median and interquartile range of the IDW weights are returned. We can potentially use some of these as thresholds in determining other suitable cut-offs inverse distance thresholds for neighbour definition if necessary.</p>
</section>
<section id="evaluation-of-spatial-weighting-methods-in-the-case-of-nigeria" class="level3">
<h3 class="anchored" data-anchor-id="evaluation-of-spatial-weighting-methods-in-the-case-of-nigeria">9.10. Evaluation of Spatial Weighting Methods in the case of Nigeria</h3>
<p>Before diving into the spatial association analysis, we weigh the pros and cons of the spatial weighting methods discussed, in the context of the problem statement of this study which is on the evaluation of <u>spatial association between the proportion of non-functional water points by LGAs</u>. The assessment is listed in the table below.</p>
<table class="table">
<colgroup>
<col style="width: 5%">
<col style="width: 48%">
<col style="width: 46%">
</colgroup>
<thead>
<tr class="header">
<th>Spatial Weighting Methods</th>
<th>Pros</th>
<th>Cons</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Contiguity method</td>
<td><p>Effective when polygons are similar in size and distribution.</p>
<p>Also effective when spatial relationships are a function of polygon proximity.</p>
<p>Concept of shared boundary is more intuitive.</p>
<p>There are 4,440 neighbour links in total using Queen’s criteria. The spread of neighbour count is appropriately at 14 or less (not too many neighbours for a single LGA).</p></td>
<td><p>The applicability of the concept of shared boundary depends on how water points are governed.</p>
<ul>
<li>E.g., if the local government of each LGA is in charge of maintaining the water points within the LGA, contiguity method would be very applicable in answering questions on spatial autocorrelation in the proportion of non-functional between LGAs.</li>
</ul>
<p>There is 1 LGA, Bakassi, which does not have any neighbour as it does not share boundary with any other LGA in Nigeria.</p></td>
</tr>
<tr class="even">
<td>Fixed distance method</td>
<td><p>Works well for point data.</p>
<p>Often effective for polygon data where there is large variation in polygon size as a consistent scale of analysis is used.</p></td>
<td><p>The number of neighbours vary widely between 1 and 69, using 71,730 m as the threshold for fixed distance weights. Too many neighbours may be captured in some instances which would affect the spatial autocorrelation analysis.</p>
<p>Total number of neighbour links is large at 17,986, hence analysis using this approach would be more computationally demanding than Queen’s contiguity method.</p></td>
</tr>
<tr class="odd">
<td>Adaptive distance method</td>
<td><p>Effective for ensuring a minimum number of neighbours for analysis, such as assigning 8 neighbours to all LGAs as a rule of thumb.</p>
<p>Works well when values associated with features are skewed (not normally distributed), which we saw is true in our case for the problem statement relating to the proportion of non-functional water points (80% of LGAs have &lt;54% non-functional water points).</p>
<p>Intermediate in terms of the total number of neighbour links (6,192), which is more than Queen’s contiguity method (4,440) but less than fixed distance method (17,986).</p>
<p>Do not need to be row-standardised as each LGA is assigned the same number of neighbours.</p></td>
<td>Tends to smooth out for smaller areas but appear more choppy for larger areas.</td>
</tr>
<tr class="even">
<td>Inverse distance method</td>
<td>Works well for modeling processes where the closer 2 features are in space, the more likely they are to interact or influence each other. E.g., water points in close proximity may be subject to similar weather conditions such as extreme dry weather.</td>
<td><p>This method is computationally intensive as theoretically, every LGA is neighbour of another LGA, hence there are 774 x 774 = 599,076 neighbour links.</p>
<ul>
<li>In this study, we chose to use Queen’s contiguity-based weights to compute the IDW matrix to limit the number of neighbours of each LGA.</li>
</ul></td>
</tr>
</tbody>
</table>
<p>On balance, <u>adaptive distance method</u> is selected for the subsequent spatial association analysis. This is because it has an intermediate number of neighbour links (which can also be adjusted by changing the “k” in k nearest neighbours), unlike contiguity-based methods which have fixed number of neighbours based on shared boundaries and fixed distance method which will not go below 17,986 if we require there to be at least 1 neighbour for all LGAs. Furthermore, we have already observed that the proportion of non-functional water points does not follow a normal distribution in Nigeria by LGAs. On the other hand, the underlying assumptions for contiguity-based (governance of water points by LGAs or otherwise) and inverse distance methods (whether points in close proximity are affected by similar factors in relation to proportion of non-functional water points) are not addressed based on the information available so far and would need to be studied further.</p>
</section>
</section>
<section id="global-spatial-autocorrelation" class="level2">
<h2 class="anchored" data-anchor-id="global-spatial-autocorrelation">10. Global Spatial Autocorrelation</h2>
<section id="global-spatial-autocorrelation-morans-i" class="level3">
<h3 class="anchored" data-anchor-id="global-spatial-autocorrelation-morans-i">10.1. Global Spatial Autocorrelation: Moran’s I</h3>
<p>Next, we will perform Moran’s I statistical testing using <a href="https://r-spatial.github.io/spdep/reference/moran.test.html"><em>moran.test()</em></a> of <strong>spdep</strong>. (Statistics How To, 2022). Moran’s I describes how features differ from the values in the study area as a whole. The formula to compute Global Moran’s I is given as follows:</p>
<p><img src="images/paste-DCC788E7.png" class="img-fluid"></p>
<p>, where</p>
<p><span class="math inline">\(wij\)</span> refers to the spatial weight between region i and region j,</p>
<p><span class="math inline">\(xi\)</span> refers to the observed value (in our case number of non-functional water points) of region i,</p>
<p><span class="math inline">\(xj\)</span> refers to the observed value of region j,</p>
<p><span class="math inline">\(x bar\)</span> refers to the mean of all observed values (excluding the diagonal in the weight matrix), and</p>
<p><span class="math inline">\(n\)</span> refers to the number of observed values or regions.</p>
<p>The interpretation of Moran’s I (Z-value), which is between 1 and -1, is as follows:</p>
<ul>
<li><p>Positive I (I &gt; 0): Clustered. Neighbouring observations tend to be similar.</p></li>
<li><p>Negative I (I &lt; 0): Dispersed. Neighbouring observations tend to be dissimilar.</p></li>
<li><p>Approximately 0: Observations are arranged randomly over space (no spatial autocorrelation).</p></li>
</ul>
<section id="morans-i-statistical-testing" class="level4">
<h4 class="anchored" data-anchor-id="morans-i-statistical-testing">Moran’s I Statistical Testing</h4>
<p>The code chunk below performs Moran’s I statistical testing. Using an upper-tailed test, the null and alternative hypotheses are as follows:</p>
<blockquote class="blockquote">
<p>H<sub>0</sub>: The observed spatial patterns of proportion of non-functional water points in Nigeria are not clustered (i.e.&nbsp;either random or dispersed).</p>
<p>H<sub>1</sub>: The observed spatial patterns of proportion of non-functional water points in Nigeria are clustered.</p>
</blockquote>
<div class="cell">
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a><span class="fu">moran.test</span>(nga_wp26392<span class="sc">$</span><span class="st">`</span><span class="at">pct_non-functional</span><span class="st">`</span>,</span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a>           <span class="at">listw =</span> rswm_knn8,</span>
<span id="cb91-3"><a href="#cb91-3" aria-hidden="true" tabindex="-1"></a>           <span class="at">zero.policy =</span> <span class="cn">TRUE</span>,</span>
<span id="cb91-4"><a href="#cb91-4" aria-hidden="true" tabindex="-1"></a>           <span class="at">alternative =</span> <span class="st">"greater"</span>,</span>
<span id="cb91-5"><a href="#cb91-5" aria-hidden="true" tabindex="-1"></a>           <span class="at">na.action =</span> na.omit)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Moran I test under randomisation

data:  nga_wp26392$`pct_non-functional`  
weights: rswm_knn8 
omitted: 3, 86, 241, 250, 252, 261, 400, 406, 447, 473, 492, 507, 526   

Moran I statistic standard deviate = 26.176, p-value &lt; 2.2e-16
alternative hypothesis: greater
sample estimates:
Moran I statistic       Expectation          Variance 
     0.4489103292     -0.0013157895      0.0002958437 </code></pre>
</div>
</div>
<p>At 5% significance level, we note that p-value is 2.2 x 10<sup>-16</sup> &lt; 0.05, and we reject H<sub>0</sub>. Hence, there is sufficient evidence to support that the observed spatial patterns of the proportion of non-functional water points in Nigeria are clustered. This is supported by a positive Moran’s I statistic of 0.449 which indicates positive clustering (i.e.&nbsp;LGAs with higher % non-functional water points tend to be geographically clustered/neighbours).</p>
</section>
<section id="monte-carlo-morans-i" class="level4">
<h4 class="anchored" data-anchor-id="monte-carlo-morans-i">Monte Carlo Moran’s I</h4>
<p>When we doubt that the assumptions of Moran’s I (i.e.&nbsp;normality and randomisation) are true, we can use a Monte Carlo simulation under the assumption of no spatial pattern and assigning all regions the mean value. We then compare the actual Moran’s I to that of the randomly simulated distribution to obtain the p-value (pseudo significance).</p>
<p>The code chunk below performs permutation test for Moran’s I statistics by using <a href="https://r-spatial.github.io/spdep/reference/moran.mc.html"><em>moran.mc()</em></a> of <strong>spdep</strong>. A total of 1000 simulations will be performed with the seed number <code>1234</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1234</span>)</span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a>bperm <span class="ot">=</span> <span class="fu">moran.mc</span>(nga_wp26392<span class="sc">$</span><span class="st">`</span><span class="at">pct_non-functional</span><span class="st">`</span>,</span>
<span id="cb93-3"><a href="#cb93-3" aria-hidden="true" tabindex="-1"></a>                 <span class="at">listw =</span> rswm_knn8,</span>
<span id="cb93-4"><a href="#cb93-4" aria-hidden="true" tabindex="-1"></a>                 <span class="at">nsim =</span> <span class="dv">999</span>,</span>
<span id="cb93-5"><a href="#cb93-5" aria-hidden="true" tabindex="-1"></a>                 <span class="at">zero.policy =</span> <span class="cn">TRUE</span>,</span>
<span id="cb93-6"><a href="#cb93-6" aria-hidden="true" tabindex="-1"></a>                 <span class="at">alternative =</span> <span class="st">"greater"</span>,</span>
<span id="cb93-7"><a href="#cb93-7" aria-hidden="true" tabindex="-1"></a>                 <span class="at">na.action =</span> na.omit)</span>
<span id="cb93-8"><a href="#cb93-8" aria-hidden="true" tabindex="-1"></a>bperm</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Monte-Carlo simulation of Moran I

data:  nga_wp26392$`pct_non-functional` 
weights: rswm_knn8 
omitted: 3, 86, 241, 250, 252, 261, 400, 406, 447, 473, 492, 507, 526 
number of simulations + 1: 1000 

statistic = 0.44891, observed rank = 1000, p-value = 0.001
alternative hypothesis: greater</code></pre>
</div>
</div>
<p>Using an upper-tailed test, we see that p-value = 0.001 is still &lt; 0.05. We similarly reject H<sub>0</sub> and conclude that at 5% significance level, there is sufficient evidence to support that the spatial distribution of % non-functional water points is positively clustered in Nigeria.</p>
</section>
<section id="visualising-monte-carlo-morans-i" class="level4">
<h4 class="anchored" data-anchor-id="visualising-monte-carlo-morans-i">Visualising Monte Carlo Moran’s I</h4>
<p>In the code chunk below, we study the summary statistics of the simulated Moran’s I test statistics using <em>mean()</em> of <strong>Base R</strong>, <em>var()</em> of <strong>mvp</strong> and <em>summary()</em> of <strong>Base R</strong>, and visualise it by plotting the distribution of the statistical values as a histogram using <a href="https://www.rdocumentation.org/packages/graphics/versions/3.6.2/topics/hist"><em>hist()</em></a> and <a href="https://www.rdocumentation.org/packages/graphics/versions/3.6.2/topics/abline"><em>abline()</em></a> of <strong>R Graphics</strong> to plot the histogram of the simulated Moran’s I and draw a cutoff line at value 0 (complete randomness) respectively. We will also use the relevant functions in <a href="https://ggplot2.tidyverse.org/"><strong>ggplot2</strong></a> for a more customisable version of the plot (e.g.&nbsp;editing the title of the plot and possibility of adjusting the visual styles). The line-by-line explanations of the codes and arguments are included as comments in the code chunks of the plots.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(bperm<span class="sc">$</span>res[<span class="dv">1</span><span class="sc">:</span><span class="dv">1000</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -0.001010919</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb97"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a><span class="fu">var</span>(bperm<span class="sc">$</span>res[<span class="dv">1</span><span class="sc">:</span><span class="dv">1000</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.0004899894</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(bperm<span class="sc">$</span>res[<span class="dv">1</span><span class="sc">:</span><span class="dv">1000</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     Min.   1st Qu.    Median      Mean   3rd Qu.      Max. 
-0.065357 -0.012534 -0.002440 -0.001011  0.010275  0.448910 </code></pre>
</div>
</div>
<p>We see that by Monte Carlo simulation, the mean and median Moran’s I value are slightly negative at -0.001 and -0.002 respectively. The variance is small at 0.0005.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(bperm<span class="sc">$</span>res, <span class="co"># plotting simulated Moran's I values</span></span>
<span id="cb101-2"><a href="#cb101-2" aria-hidden="true" tabindex="-1"></a>     <span class="at">freq =</span> <span class="cn">TRUE</span>, <span class="co"># histogram is a representation of frequencies, i.e. counts</span></span>
<span id="cb101-3"><a href="#cb101-3" aria-hidden="true" tabindex="-1"></a>     <span class="at">breaks =</span> <span class="dv">100</span>, <span class="co"># breaks it into 100 cells or bins </span></span>
<span id="cb101-4"><a href="#cb101-4" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">"Simulated Moran's I"</span>) <span class="co"># x-axis label</span></span>
<span id="cb101-5"><a href="#cb101-5" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">v =</span> <span class="dv">0</span>, <span class="co"># plotting vertical line at value 0</span></span>
<span id="cb101-6"><a href="#cb101-6" aria-hidden="true" tabindex="-1"></a>       <span class="at">col =</span> <span class="st">"red"</span>) <span class="co"># plot the vertical line in red colour</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Take-home_Ex1_files/figure-html/unnamed-chunk-65-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb102"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(bperm<span class="sc">$</span>res) <span class="co"># converting the simulated Moran's I values into a data frame</span></span>
<span id="cb102-2"><a href="#cb102-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(df,</span>
<span id="cb102-3"><a href="#cb102-3" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x =</span> bperm<span class="sc">$</span>res)) <span class="sc">+</span> <span class="co"># plotting the simulated Moran's I values</span></span>
<span id="cb102-4"><a href="#cb102-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">binwidth =</span> <span class="fl">0.005</span>, <span class="co"># 100 bins</span></span>
<span id="cb102-5"><a href="#cb102-5" aria-hidden="true" tabindex="-1"></a>                 <span class="at">boundary =</span> <span class="dv">0</span>, <span class="co"># shift the boundary of the bin align with value 0 (rather than let value 0 cut the bin in half)</span></span>
<span id="cb102-6"><a href="#cb102-6" aria-hidden="true" tabindex="-1"></a>                 <span class="at">color =</span> <span class="st">"black"</span>, <span class="co"># colour of borders of bins</span></span>
<span id="cb102-7"><a href="#cb102-7" aria-hidden="true" tabindex="-1"></a>                 <span class="at">fill =</span> <span class="st">"grey"</span>) <span class="sc">+</span> <span class="co"># colour of fill of bins</span></span>
<span id="cb102-8"><a href="#cb102-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="co"># plotting a vertical line at x-axis = 0</span></span>
<span id="cb102-9"><a href="#cb102-9" aria-hidden="true" tabindex="-1"></a>             <span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span> <span class="co"># colour the vertical line red</span></span>
<span id="cb102-10"><a href="#cb102-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Histogram of simulated Moran's I (adaptive distance weight matrix)"</span>, <span class="co"># title of plot</span></span>
<span id="cb102-11"><a href="#cb102-11" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Simulated Moran's I"</span>, <span class="co"># x-axis label</span></span>
<span id="cb102-12"><a href="#cb102-12" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Frequency"</span>) <span class="sc">+</span> <span class="co"># y-axis label</span></span>
<span id="cb102-13"><a href="#cb102-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span> <span class="co"># black-and-white theme </span></span>
<span id="cb102-14"><a href="#cb102-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid.major =</span> <span class="fu">element_blank</span>(), <span class="co"># remove the default grids (major) that are included in ggplot</span></span>
<span id="cb102-15"><a href="#cb102-15" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(), <span class="co"># remove the default grids (minor) that are included in ggplot</span></span>
<span id="cb102-16"><a href="#cb102-16" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.4</span>)) <span class="co"># specifying text size of plot title </span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Take-home_Ex1_files/figure-html/unnamed-chunk-66-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>We see that the maximum value of 0.449 from the summary statistics, which is the Moran’s I computed from the row-standardised weight matrix of adaptive distance method (<code>rswm_knn8</code>), appear on the extreme right of the histogram plot. The plot shows visually how the Moran’s I value is unlikely to be by chance against randomly simulated values, hence statistically significant at 0.05 significance level.</p>
</section>
</section>
<section id="global-spatial-autocorrelation-gearys-c" class="level3">
<h3 class="anchored" data-anchor-id="global-spatial-autocorrelation-gearys-c">10.2. Global Spatial Autocorrelation: Geary’s C</h3>
<p>In this section, we will perform Geary’s C statistical testing by using the <a href="https://r-spatial.github.io/spdep/reference/geary.test.html"><em>geary.test()</em></a> function of <strong>spdep</strong>. Geary’s C describes how features differ from their immediate neighbours. The formula for calculating Global Geary’s C is given below.</p>
<p><img src="images/paste-A424FDED.png" class="img-fluid"></p>
<p>The interpretation of Geary’s C (Z-value), which is between 0 and 2, is as follows:</p>
<ul>
<li><p>Small C (&lt; 1): Clustered. Neighbouring observations tend to be similar.</p></li>
<li><p>Large C (&gt; 1): Dispersed. Neighbouring observations tend to be dissimilar.</p></li>
<li><p>C = 1: Observations are arranged randomly over space (no spatial autocorrelation).</p></li>
</ul>
<p>Note that the direction which represents clustering is opposite for Moran’s I as for Geary’s C.</p>
<section id="gearys-c-statistical-testing" class="level4">
<h4 class="anchored" data-anchor-id="gearys-c-statistical-testing">Geary’s C Statistical Testing</h4>
<p>The null and alternative hypotheses are similar to that in Moran’s I. However, as Geary’s C test cannot take NA values (<em>geary.test()</em> has no argument for <code>na.action = na.omit</code>, unlike <em>moran.mc()</em>) which are present in the <code>pct_non-functional</code> field where there are no water points in certain area, we will use the absolute number of non-functional water points for this analysis.</p>
<blockquote class="blockquote">
<p>H<sub>0</sub>: The observed spatial patterns of number of non-functional water points in Nigeria are not clustered (i.e.&nbsp;either random or dispersed).</p>
<p>H<sub>1</sub>: The observed spatial patterns of number of non-functional water points in Nigeria are clustered.</p>
</blockquote>
<div class="cell">
<div class="sourceCode cell-code" id="cb103"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a><span class="fu">geary.test</span>(nga_wp26392<span class="sc">$</span><span class="st">`</span><span class="at">wpt non-functional</span><span class="st">`</span>,</span>
<span id="cb103-2"><a href="#cb103-2" aria-hidden="true" tabindex="-1"></a>           <span class="at">listw =</span> rswm_knn8,</span>
<span id="cb103-3"><a href="#cb103-3" aria-hidden="true" tabindex="-1"></a>           <span class="at">zero.policy =</span> <span class="cn">TRUE</span>,</span>
<span id="cb103-4"><a href="#cb103-4" aria-hidden="true" tabindex="-1"></a>           <span class="at">alternative =</span> <span class="st">"greater"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Geary C test under randomisation

data:  nga_wp26392$`wpt non-functional` 
weights: rswm_knn8 

Geary C statistic standard deviate = 19.417, p-value &lt; 2.2e-16
alternative hypothesis: Expectation greater than statistic
sample estimates:
Geary C statistic       Expectation          Variance 
     0.6045492320      1.0000000000      0.0004147634 </code></pre>
</div>
</div>
<p>With a p-value = 2.2 x 10<sup>-16</sup> &lt; 0.05, at 5% significant level and 95% confidence level, we reject H<sub>0</sub>. Hence, there is sufficient evidence to support that the observed spatial patterns of the number of non-functional water points in Nigeria are clustered. This is supported by a small Geary’s C statistic of 0.691 &lt; 1. This implies that LGAs with higher number of non-functional water points tend to be geographically clustered/neighbours.</p>
</section>
<section id="monte-carlo-gearys-c" class="level4">
<h4 class="anchored" data-anchor-id="monte-carlo-gearys-c">Monte Carlo Geary’s C</h4>
<p>The code chunk below performs permutation test for Geary’s C statistic using <a href="https://r-spatial.github.io/spdep/reference/geary.mc.html"><em>geary.mc()</em></a> of <strong>spdep</strong>. We similarly set seed number of 1234 for the simulation for reproducible results.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb105"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1234</span>)</span>
<span id="cb105-2"><a href="#cb105-2" aria-hidden="true" tabindex="-1"></a>bperm <span class="ot">=</span> <span class="fu">geary.mc</span>(nga_wp26392<span class="sc">$</span><span class="st">`</span><span class="at">wpt non-functional</span><span class="st">`</span>,</span>
<span id="cb105-3"><a href="#cb105-3" aria-hidden="true" tabindex="-1"></a>                 <span class="at">listw =</span> rswm_knn8,</span>
<span id="cb105-4"><a href="#cb105-4" aria-hidden="true" tabindex="-1"></a>                 <span class="at">nsim =</span> <span class="dv">999</span>,</span>
<span id="cb105-5"><a href="#cb105-5" aria-hidden="true" tabindex="-1"></a>                 <span class="at">zero.policy =</span> <span class="cn">TRUE</span>,</span>
<span id="cb105-6"><a href="#cb105-6" aria-hidden="true" tabindex="-1"></a>                 <span class="at">alternative =</span> <span class="st">"greater"</span>)</span>
<span id="cb105-7"><a href="#cb105-7" aria-hidden="true" tabindex="-1"></a>bperm</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Monte-Carlo simulation of Geary C

data:  nga_wp26392$`wpt non-functional` 
weights: rswm_knn8 
number of simulations + 1: 1000 

statistic = 0.60455, observed rank = 1, p-value = 0.001
alternative hypothesis: greater</code></pre>
</div>
</div>
<p>The Monte Carlo simulation returned similar result of a significant p-value (0.001) at 5% significance level. Hence, we reject H<sub>0</sub> and conclude that there is sufficient evidence to support that the spatial distribution of the number of non-functional water points is positively clustered in Nigeria.</p>
</section>
<section id="visualising-monte-carlo-gearys-c" class="level4">
<h4 class="anchored" data-anchor-id="visualising-monte-carlo-gearys-c">Visualising Monte Carlo Geary’s C</h4>
<p>Like we did for Moran’s I, we will plot a histogram to reveal the distribution of the simulated values of Geary’s C by using the following code chunks.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb107"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(bperm<span class="sc">$</span>res[<span class="dv">1</span><span class="sc">:</span><span class="dv">1000</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
 0.6045  0.9857  0.9996  0.9988  1.0127  1.0690 </code></pre>
</div>
</div>
<p>Similar to Moran’s I which is the maximum among the simulated values, the Geary’s C is the minimum compared to the simulated values.</p>
<p>Doing a quick plot using <em>hist()</em> and <em>abline()</em> of <strong>R Graphics</strong> in the code chunk below, we see that the Geary’s C statistics is at the extreme left of the plot, some distance away from the rest of the simulated values which is distributed rather narrowly around value 1 which represents randomness.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb109"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb109-1"><a href="#cb109-1" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(bperm<span class="sc">$</span>res,</span>
<span id="cb109-2"><a href="#cb109-2" aria-hidden="true" tabindex="-1"></a>     <span class="at">freq =</span> <span class="cn">TRUE</span>,</span>
<span id="cb109-3"><a href="#cb109-3" aria-hidden="true" tabindex="-1"></a>     <span class="at">breaks =</span> <span class="dv">100</span>,</span>
<span id="cb109-4"><a href="#cb109-4" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">"Simulated Geary's C"</span>)</span>
<span id="cb109-5"><a href="#cb109-5" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">v =</span> <span class="dv">1</span>,</span>
<span id="cb109-6"><a href="#cb109-6" aria-hidden="true" tabindex="-1"></a>       <span class="at">col =</span> <span class="st">"red"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Take-home_Ex1_files/figure-html/unnamed-chunk-70-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
</section>
</section>
<section id="spatial-correlogram" class="level2">
<h2 class="anchored" data-anchor-id="spatial-correlogram">11. Spatial Correlogram</h2>
<p>Spatial correlograms are used to examine patterns of spatial autocorrelation. They show how correlated are pairs of spatial observations when you increase the distance (lag) between them - they are plots of some index of autocorrelation (Moran’s I or Geary’s c) against distance. Row-standardisation is not needed.</p>
<section id="morans-i-correlogram" class="level3">
<h3 class="anchored" data-anchor-id="morans-i-correlogram">11.1. Moran’s I Correlogram</h3>
<p>In the code chunk below, <a href="https://r-spatial.github.io/spdep/reference/sp.correlogram.html"><em>sp.correlogram()</em></a> of <strong>spdep</strong> is used to compute a 1- to 10-lag spatial correlogram of the number of non-functional water points. The global spatial autocorrelation used is Moran’s I. The <em>plot()</em> of R’s base <strong>Graph</strong> is used to plot the output.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb110"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb110-1"><a href="#cb110-1" aria-hidden="true" tabindex="-1"></a>MI_corr <span class="ot">&lt;-</span> <span class="fu">sp.correlogram</span>(knn8,</span>
<span id="cb110-2"><a href="#cb110-2" aria-hidden="true" tabindex="-1"></a>                          nga_wp26392<span class="sc">$</span><span class="st">`</span><span class="at">wpt non-functional</span><span class="st">`</span>,</span>
<span id="cb110-3"><a href="#cb110-3" aria-hidden="true" tabindex="-1"></a>                          <span class="at">order =</span> <span class="dv">10</span>,</span>
<span id="cb110-4"><a href="#cb110-4" aria-hidden="true" tabindex="-1"></a>                          <span class="at">method =</span> <span class="st">"I"</span>,</span>
<span id="cb110-5"><a href="#cb110-5" aria-hidden="true" tabindex="-1"></a>                          <span class="at">style =</span> <span class="st">"W"</span>)</span>
<span id="cb110-6"><a href="#cb110-6" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(MI_corr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Take-home_Ex1_files/figure-html/unnamed-chunk-71-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>From the plot, Moran’s I is positive for up to 7 lags, beyond which Moran’s I drops below 0. It is also noted that the rate of decrease of Moran’s I slows between 2 and 7 lags. This means that the number of non-functional water points has a wider spread across order 2-7 LGAs.</p>
<p>In addition to this, it is necessary to examine the full statistical report as not all autocorrelation values are statistically significant. This is done using the <em>print()</em> function of <strong>Base R</strong> in the code chunk below.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb111"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb111-1"><a href="#cb111-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(MI_corr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Spatial correlogram for nga_wp26392$`wpt non-functional` 
method: Moran's I
            estimate expectation    variance standard deviate Pr(I) two sided
1 (774)   3.8301e-01 -1.2937e-03  2.8620e-04          22.7165       &lt; 2.2e-16
2 (774)   2.4971e-01 -1.2937e-03  1.4425e-04          20.8986       &lt; 2.2e-16
3 (774)   1.7521e-01 -1.2937e-03  9.8556e-05          17.7796       &lt; 2.2e-16
4 (774)   1.1511e-01 -1.2937e-03  7.3007e-05          13.6237       &lt; 2.2e-16
5 (774)   7.3431e-02 -1.2937e-03  5.7167e-05           9.8830       &lt; 2.2e-16
6 (774)   3.3089e-02 -1.2937e-03  4.7503e-05           4.9886       6.083e-07
7 (774)   2.5333e-03 -1.2937e-03  4.1561e-05           0.5936       0.5527628
8 (774)  -2.3521e-02 -1.2937e-03  3.7193e-05          -3.6447       0.0002677
9 (774)  -5.7915e-02 -1.2937e-03  3.4219e-05          -9.6795       &lt; 2.2e-16
10 (774) -9.0564e-02 -1.2937e-03  3.2638e-05         -15.6260       &lt; 2.2e-16
            
1 (774)  ***
2 (774)  ***
3 (774)  ***
4 (774)  ***
5 (774)  ***
6 (774)  ***
7 (774)     
8 (774)  ***
9 (774)  ***
10 (774) ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
<p>At 5% significance level, the autocorrelation values are statistically significant for all lags between 1 and 10, except 7-lag where Moran’s I is close to 0, suggesting randomness.</p>
</section>
<section id="gearys-c-correlogram" class="level3">
<h3 class="anchored" data-anchor-id="gearys-c-correlogram">11.2. Geary’s C Correlogram</h3>
<p>In the code chunk below, we perform a similar analysis using the <em>sp.correlogram()</em> function from the <strong>spdep</strong> package, except using Geary’s C global spatial autocorrelation. We also plot the output using <em>plot()</em> from R’s base <strong>Graph</strong>, and <em>print()</em> of <strong>Base R</strong> the full report for the p-values.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb113"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb113-1"><a href="#cb113-1" aria-hidden="true" tabindex="-1"></a>GC_corr <span class="ot">&lt;-</span> <span class="fu">sp.correlogram</span>(knn8,</span>
<span id="cb113-2"><a href="#cb113-2" aria-hidden="true" tabindex="-1"></a>                          nga_wp26392<span class="sc">$</span><span class="st">`</span><span class="at">wpt non-functional</span><span class="st">`</span>,</span>
<span id="cb113-3"><a href="#cb113-3" aria-hidden="true" tabindex="-1"></a>                          <span class="at">order =</span> <span class="dv">10</span>,</span>
<span id="cb113-4"><a href="#cb113-4" aria-hidden="true" tabindex="-1"></a>                          <span class="at">method =</span> <span class="st">"C"</span>,</span>
<span id="cb113-5"><a href="#cb113-5" aria-hidden="true" tabindex="-1"></a>                          <span class="at">style =</span> <span class="st">"W"</span>)</span>
<span id="cb113-6"><a href="#cb113-6" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(GC_corr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Take-home_Ex1_files/figure-html/unnamed-chunk-73-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb114"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb114-1"><a href="#cb114-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(GC_corr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Spatial correlogram for nga_wp26392$`wpt non-functional` 
method: Geary's C
           estimate expectation   variance standard deviate Pr(I) two sided    
1 (774)  0.60454923  1.00000000 0.00041476         -19.4175       &lt; 2.2e-16 ***
2 (774)  0.73870958  1.00000000 0.00030714         -14.9092       &lt; 2.2e-16 ***
3 (774)  0.83010250  1.00000000 0.00031562          -9.5632       &lt; 2.2e-16 ***
4 (774)  0.90114899  1.00000000 0.00026699          -6.0497       1.451e-09 ***
5 (774)  0.94956303  1.00000000 0.00024652          -3.2123        0.001317 ** 
6 (774)  0.97528831  1.00000000 0.00024335          -1.5841        0.113168    
7 (774)  1.01619690  1.00000000 0.00026266           0.9994        0.317608    
8 (774)  1.05667901  1.00000000 0.00031434           3.1969        0.001389 ** 
9 (774)  1.07820775  1.00000000 0.00037455           4.0410       5.321e-05 ***
10 (774) 1.10044556  1.00000000 0.00041110           4.9540       7.270e-07 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
<p>The results for Geary’s C correlogram are similar to that for Moran’s I in that positive clustering pattern for the number of non-functional water points is observed for up to 6 lags, where Geary’s C is &lt;1 and Moran’s I is &gt; 0. At 7-lag, the spatial distribution is approximately random. Beyond which, the spatial pattern reverses to negative clustering pattern (dispersion).</p>
<p>However, unlike Moran’s I correlogram, Geary’s C correlogram has p-values which are significant for 1- to 10-lag except both 6- and 7-lag, at 5% significance level. Nevertheless, the overall trend is similar and we can interpret the slowing of the increase in Geary’s C to have a wider spread as the number of lags increases.</p>
</section>
</section>
<section id="cluster-and-outlier-analysis" class="level2">
<h2 class="anchored" data-anchor-id="cluster-and-outlier-analysis">12. Cluster and Outlier Analysis</h2>
<p>Local Indicator of Spatial Association (LISA) is a subset of localised geospatial statistics methods for analysing the location-related tendency (clusters or outliers) in the attributes of geographically referenced data (points or area). The LISA for each observation gives an indication of the extent of significant spatial clustering of similar values around that observation. The sum of LISAs for all observations is proportional to a global indicator of spatial association.</p>
<p>We will apply local Moran’s I to detect clusters and/or outliers from the water point data in Nigeria.</p>
<section id="local-morans-i" class="level3">
<h3 class="anchored" data-anchor-id="local-morans-i">12.1. Local Moran’s I</h3>
<p>The code chunk below computes the local Moran’s I using the <a href="https://r-spatial.github.io/spdep/reference/localmoran.html"><em>localmoran()</em></a> function of the <strong>spdep</strong> package. We will use the row-standardised weights matrix here. We will similarly use the number of non-functional water points instead of proportion due to NA value handling.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb116"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb116-1"><a href="#cb116-1" aria-hidden="true" tabindex="-1"></a>fips <span class="ot">&lt;-</span> <span class="fu">order</span>(nga_wp26392<span class="sc">$</span><span class="st">`</span><span class="at">wpt non-functional</span><span class="st">`</span>)</span>
<span id="cb116-2"><a href="#cb116-2" aria-hidden="true" tabindex="-1"></a>localMI <span class="ot">&lt;-</span> <span class="fu">localmoran</span>(nga_wp26392<span class="sc">$</span><span class="st">`</span><span class="at">wpt non-functional</span><span class="st">`</span>, </span>
<span id="cb116-3"><a href="#cb116-3" aria-hidden="true" tabindex="-1"></a>                      rswm_knn8, </span>
<span id="cb116-4"><a href="#cb116-4" aria-hidden="true" tabindex="-1"></a>                      <span class="at">zero.policy =</span> <span class="cn">TRUE</span>)</span>
<span id="cb116-5"><a href="#cb116-5" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(localMI)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>            Ii          E.Ii       Var.Ii       Z.Ii Pr(z != E(Ii))
1 -0.080696263 -9.995243e-04 9.573134e-02 -0.2575808    0.796730455
2 -0.022923567 -4.092463e-05 3.923396e-03 -0.3653214    0.714871500
3  1.258199847 -1.627684e-03 1.557965e-01  3.1917746    0.001414017
4 -0.031922684 -5.427505e-05 5.203215e-03 -0.4417988    0.658634818
5  0.091666434 -2.590965e-04 2.483385e-02  0.5833297    0.559671349
6  0.007875149 -1.538445e-07 1.474949e-05  2.0505897    0.040306916</code></pre>
</div>
</div>
<p>We obtain the following statistics for the first 6 output:</p>
<ul>
<li><p><code>Ii</code>: Local Moran statistic</p></li>
<li><p><code>E.Ii</code>: Expectation of local Moran statistic</p></li>
<li><p><code>Var.Ii</code>: Variance of local Moran statistic</p></li>
<li><p><code>Z.Ii</code>: Standard deviate of local Moran statistic</p></li>
<li><p><code>Pr()</code>: p-value of local Moran statistic</p></li>
</ul>
<p>The code chunk below can help to list the content of the local Moran matrix derived using <a href="https://www.rdocumentation.org/packages/stats/versions/3.6.2/topics/printCoefmat"><em>printCoefmat()</em></a> function from R’s <strong>Stats</strong> package. For the purpose of this report, we will set <code>#| eval: false</code> to avoid displaying the full list of statistics for all 774 LGAs, but to show a screenshot of the first 6 observations below.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb118"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb118-1"><a href="#cb118-1" aria-hidden="true" tabindex="-1"></a><span class="fu">printCoefmat</span>(<span class="fu">data.frame</span>(localMI[fips,]))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><img src="images/paste-0EB1BE87.png" class="img-fluid"></p>
<p>We will map the Local Moran’s I in the next sub-section to visualise the LGAs by their p-values.</p>
</section>
<section id="mapping-local-morans-i" class="level3">
<h3 class="anchored" data-anchor-id="mapping-local-morans-i">12.2. Mapping Local Moran’s I</h3>
<p>Before mapping the local Moran’s I, we want to append the local Moran’s I dataframe (i.e.&nbsp;<code>localMI</code>) to the <code>nga_wp26392</code> SpatialPolygonDataFrame. The code chunk below does this using the <a href="https://www.rdocumentation.org/packages/base/versions/3.6.2/topics/cbind"><em>cbind()</em></a> function from R <strong>base</strong> which combine the vectors as columns in the final matrix. We also rename the p-value (<code>Pr.z….E.Ii</code>) variable title to <code>Pr.Ii</code> for neatness.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb119"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb119-1"><a href="#cb119-1" aria-hidden="true" tabindex="-1"></a>nga_wp26392.localMI <span class="ot">&lt;-</span> <span class="fu">cbind</span>(nga_wp26392, localMI) <span class="sc">%&gt;%</span></span>
<span id="cb119-2"><a href="#cb119-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">Pr.Ii =</span> Pr.z....E.Ii..)</span>
<span id="cb119-3"><a href="#cb119-3" aria-hidden="true" tabindex="-1"></a>nga_wp26392.localMI</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Simple feature collection with 774 features and 21 fields
Geometry type: MULTIPOLYGON
Dimension:     XY
Bounding box:  xmin: 26662.71 ymin: 30523.38 xmax: 1344157 ymax: 1096029
Projected CRS: Minna / Nigeria Mid Belt
First 10 features:
        shapeName Level                    shapeID shapeGroup shapeType
1       Aba North  ADM2 NGA-ADM2-72505758B79815894        NGA      ADM2
2       Aba South  ADM2 NGA-ADM2-72505758B67905963        NGA      ADM2
3          Abadam  ADM2 NGA-ADM2-72505758B57073987        NGA      ADM2
4           Abaji  ADM2 NGA-ADM2-72505758B61968000        NGA      ADM2
5            Abak  ADM2 NGA-ADM2-72505758B39432389        NGA      ADM2
6       Abakaliki  ADM2 NGA-ADM2-72505758B36739173        NGA      ADM2
7  Abeokuta North  ADM2 NGA-ADM2-72505758B86358915        NGA      ADM2
8  Abeokuta South  ADM2 NGA-ADM2-72505758B56925175        NGA      ADM2
9             Abi  ADM2  NGA-ADM2-72505758B1616690        NGA      ADM2
10    Aboh-Mbaise  ADM2 NGA-ADM2-72505758B78555816        NGA      ADM2
   total.wpt wpt.functional wpt.non.functional wpt.unknown pct_functional
1         17              7                  9           1      0.4117647
2         71             29                 35           7      0.4084507
3          0              0                  0           0            NaN
4         57             23                 34           0      0.4035088
5         48             23                 25           0      0.4791667
6        233             82                 42         109      0.3519313
7         34             16                 15           3      0.4705882
8        119             72                 33          14      0.6050420
9        152             79                 62          11      0.5197368
10        66             18                 26          22      0.2727273
   pct_non.functional             Area      total_density functional_density
1           0.5294118   18683264 [m^2] 0.90990526 [1/m^2] 0.37466687 [1/m^2]
2           0.4929577   43293877 [m^2] 1.63995477 [1/m^2] 0.66984068 [1/m^2]
3                 NaN 3940900450 [m^2] 0.00000000 [1/m^2] 0.00000000 [1/m^2]
4           0.5964912  832227367 [m^2] 0.06849090 [1/m^2] 0.02763668 [1/m^2]
5           0.5208333  178106187 [m^2] 0.26950215 [1/m^2] 0.12913645 [1/m^2]
6           0.1802575  463152896 [m^2] 0.50307361 [1/m^2] 0.17704737 [1/m^2]
7           0.4411765  774688813 [m^2] 0.04388859 [1/m^2] 0.02065345 [1/m^2]
8           0.2773109   56726506 [m^2] 2.09778476 [1/m^2] 1.26924792 [1/m^2]
9           0.4078947  267817253 [m^2] 0.56755119 [1/m^2] 0.29497726 [1/m^2]
10          0.3939394  176198100 [m^2] 0.37457839 [1/m^2] 0.10215774 [1/m^2]
   non.functional_density     unknown_density           Ii          E.Ii
1      0.48171455 [1/m^2] 0.053523839 [1/m^2] -0.080696263 -9.995243e-04
2      0.80842841 [1/m^2] 0.161685681 [1/m^2] -0.022923567 -4.092463e-05
3      0.00000000 [1/m^2] 0.000000000 [1/m^2]  1.258199847 -1.627684e-03
4      0.04085422 [1/m^2] 0.000000000 [1/m^2] -0.031922684 -5.427505e-05
5      0.14036570 [1/m^2] 0.000000000 [1/m^2]  0.091666434 -2.590965e-04
6      0.09068280 [1/m^2] 0.235343449 [1/m^2]  0.007875149 -1.538445e-07
7      0.01936261 [1/m^2] 0.003872523 [1/m^2]  0.158989521 -6.654187e-04
8      0.58173863 [1/m^2] 0.246798207 [1/m^2]  0.113892231 -6.950696e-05
9      0.23150114 [1/m^2] 0.041072783 [1/m^2]  0.363969643 -3.916720e-04
10     0.14756118 [1/m^2] 0.124859462 [1/m^2]  0.191048508 -2.288125e-04
         Var.Ii       Z.Ii       Pr.Ii                       geometry
1  9.573134e-02 -0.2575808 0.796730455 MULTIPOLYGON (((548795.5 11...
2  3.923396e-03 -0.3653214 0.714871500 MULTIPOLYGON (((541412.3 12...
3  1.557965e-01  3.1917746 0.001414017 MULTIPOLYGON (((1248985 104...
4  5.203215e-03 -0.4417988 0.658634818 MULTIPOLYGON (((510864.9 57...
5  2.483385e-02  0.5833297 0.559671349 MULTIPOLYGON (((594269 1209...
6  1.474949e-05  2.0505897 0.040306916 MULTIPOLYGON (((660767 2522...
7  6.375306e-02  0.6323126 0.527182630 MULTIPOLYGON (((78621.56 37...
8  6.663359e-03  1.3960869 0.162688338 MULTIPOLYGON (((95752.33 34...
9  3.753596e-02  1.8806523 0.060019238 MULTIPOLYGON (((632244.2 21...
10 2.193186e-02  1.2915931 0.196498081 MULTIPOLYGON (((540081.3 15...</code></pre>
</div>
</div>
<p>The code chunk below plots the local Moran’s I values and their statistical significance (based on p-values) using the choropleth mapping functions from the <strong>tmap</strong> package.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb121"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb121-1"><a href="#cb121-1" aria-hidden="true" tabindex="-1"></a>localMI.map <span class="ot">&lt;-</span> <span class="fu">tm_shape</span>(nga_wp26392.localMI) <span class="sc">+</span></span>
<span id="cb121-2"><a href="#cb121-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_fill</span>(<span class="at">col =</span> <span class="st">"Ii"</span>,</span>
<span id="cb121-3"><a href="#cb121-3" aria-hidden="true" tabindex="-1"></a>          <span class="at">style =</span> <span class="st">"pretty"</span>,</span>
<span id="cb121-4"><a href="#cb121-4" aria-hidden="true" tabindex="-1"></a>          <span class="at">palette =</span> <span class="st">"RdBu"</span>,</span>
<span id="cb121-5"><a href="#cb121-5" aria-hidden="true" tabindex="-1"></a>          <span class="at">title =</span> <span class="st">"Local Moran statistics"</span>) <span class="sc">+</span></span>
<span id="cb121-6"><a href="#cb121-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_borders</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>)</span>
<span id="cb121-7"><a href="#cb121-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-8"><a href="#cb121-8" aria-hidden="true" tabindex="-1"></a>pvalue.map <span class="ot">&lt;-</span> <span class="fu">tm_shape</span>(nga_wp26392.localMI) <span class="sc">+</span></span>
<span id="cb121-9"><a href="#cb121-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_fill</span>(<span class="at">col =</span> <span class="st">"Pr.Ii"</span>,</span>
<span id="cb121-10"><a href="#cb121-10" aria-hidden="true" tabindex="-1"></a>          <span class="at">breaks =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="cn">Inf</span>, <span class="fl">0.001</span>, <span class="fl">0.01</span>, <span class="fl">0.05</span>, <span class="fl">0.1</span>, <span class="cn">Inf</span>),</span>
<span id="cb121-11"><a href="#cb121-11" aria-hidden="true" tabindex="-1"></a>          <span class="at">palette =</span> <span class="st">"-Blues"</span>,</span>
<span id="cb121-12"><a href="#cb121-12" aria-hidden="true" tabindex="-1"></a>          <span class="at">title =</span> <span class="st">"Local Moran's I p-values"</span>) <span class="sc">+</span></span>
<span id="cb121-13"><a href="#cb121-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_borders</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>)</span>
<span id="cb121-14"><a href="#cb121-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-15"><a href="#cb121-15" aria-hidden="true" tabindex="-1"></a><span class="fu">tmap_arrange</span>(localMI.map, pvalue.map, <span class="at">asp =</span> <span class="dv">1</span>, <span class="at">ncol =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Take-home_Ex1_files/figure-html/unnamed-chunk-78-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>On the left, we note regions of positive (blue) and negative (orange) Moran’s I statistics, indicative of positive and negative clustering relationships. Zooming in, we see that Ifelodun, Igabi and Kudan have the highest Local Moran’s I statistics.</p>
<p>On the right, we see that the p-values are significant at 5% significance level for the regions in top 3 darkest shades of blue. Besides LGAs with high Local Moran’s I above 6 that we listed, where the p-values are statistically significant, we see that the East, South, Southwest and Central regions generally have statistically significant p-values for the cluster/outlier spatial relationships that they see.</p>
</section>
</section>
<section id="creating-a-lisa-cluster-map" class="level2">
<h2 class="anchored" data-anchor-id="creating-a-lisa-cluster-map">13. Creating a LISA Cluster Map</h2>
<p>The LISA Cluster Map shows the significant locations colour-coded by type of spatial autocorrelation. The first step is to plot the Moran scatterplot.</p>
<section id="plotting-moran-scatterplot" class="level3">
<h3 class="anchored" data-anchor-id="plotting-moran-scatterplot">13.1. Plotting Moran Scatterplot</h3>
<p>The Moran scatterplot is an illustration of the relationship between the values of the chosen attributes at each location and the average value of the same attribute at neighbouring locations.</p>
<p>The code chunk below plots the Moran scatterplot of the number of non-functional water points by using <a href="https://r-spatial.github.io/spdep/reference/moran.plot.html"><em>moran.plot()</em></a> of <strong>spdep</strong>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb122"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb122-1"><a href="#cb122-1" aria-hidden="true" tabindex="-1"></a>nci <span class="ot">&lt;-</span> <span class="fu">moran.plot</span>(nga_wp26392<span class="sc">$</span><span class="st">`</span><span class="at">wpt non-functional</span><span class="st">`</span>,</span>
<span id="cb122-2"><a href="#cb122-2" aria-hidden="true" tabindex="-1"></a>                  rswm_knn8,</span>
<span id="cb122-3"><a href="#cb122-3" aria-hidden="true" tabindex="-1"></a>                  <span class="at">labels =</span> <span class="fu">as.character</span>(nga_wp26392<span class="sc">$</span>shapeName),</span>
<span id="cb122-4"><a href="#cb122-4" aria-hidden="true" tabindex="-1"></a>                  <span class="at">xlab =</span> <span class="st">"No. of non-functional water points"</span>,</span>
<span id="cb122-5"><a href="#cb122-5" aria-hidden="true" tabindex="-1"></a>                  <span class="at">ylab =</span> <span class="st">"Spatially lagged non-functional water points"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Take-home_Ex1_files/figure-html/unnamed-chunk-79-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>The Moran scatterplot can be interpreted by the 4 quadrants:</p>
<ul>
<li><p>Top-right (high-high): Positive autocorrelation, i.e.&nbsp;clusters (the region and its neighbours all have high values)</p></li>
<li><p>Bottom-left (low-low): Positive autocorrelation, i.e.&nbsp;clusters (the region and its neighbours all have low values)</p></li>
<li><p>Top-left (low-high): Negative autocorrelation, i.e.&nbsp;outlier (low outlier among high neighbours)</p></li>
<li><p>Bottom-right (high-low): Negative autocorrelation, i.e.&nbsp;outlier (high outlier among low neighbours)</p></li>
</ul>
<p>The direction and magnitude of global autocorrelation can be observed in the Moran scatterplot, as the slope of the linear regression of the lagged values of number of non-functional water points versus the original number of non-functional water points is equivalent to the Moran’s I score (Kam &amp; Zhi, 2018).</p>
<p>We see that more regions follow a cluster autocorrelation pattern (high-high and low-low quadrants) rather than outlier pattern (low-high and high-low quadrants).</p>
<p>We also plot the Moran scatterplot for the number of functional water points, and notice a similar trend.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb123"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb123-1"><a href="#cb123-1" aria-hidden="true" tabindex="-1"></a>nci_f <span class="ot">&lt;-</span> <span class="fu">moran.plot</span>(nga_wp26392<span class="sc">$</span><span class="st">`</span><span class="at">wpt functional</span><span class="st">`</span>,</span>
<span id="cb123-2"><a href="#cb123-2" aria-hidden="true" tabindex="-1"></a>                  rswm_knn8,</span>
<span id="cb123-3"><a href="#cb123-3" aria-hidden="true" tabindex="-1"></a>                  <span class="at">labels =</span> <span class="fu">as.character</span>(nga_wp26392<span class="sc">$</span>shapeName),</span>
<span id="cb123-4"><a href="#cb123-4" aria-hidden="true" tabindex="-1"></a>                  <span class="at">xlab =</span> <span class="st">"No. of functional water points"</span>,</span>
<span id="cb123-5"><a href="#cb123-5" aria-hidden="true" tabindex="-1"></a>                  <span class="at">ylab =</span> <span class="st">"Spatially lagged functional water points"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Take-home_Ex1_files/figure-html/unnamed-chunk-80-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="plotting-moran-scatterplot-with-standardised-variables" class="level3">
<h3 class="anchored" data-anchor-id="plotting-moran-scatterplot-with-standardised-variables">13.2. Plotting Moran Scatterplot with Standardised Variables</h3>
<p>First, we use <a href="https://www.rdocumentation.org/packages/base/versions/3.6.2/topics/scale"><em>scale()</em></a> from <strong>Base R</strong> to centre and scale the variables. Here, centering is done by subtracting the mean (omitting NAs) from the corresponding columns, and scaling is done by dividing the (centred) variables by their standard deviations. The <a href="https://www.rdocumentation.org/packages/pbdDMAT/versions/0.5-1/topics/as.vector"><em>as.vector()</em></a> from the <a href="https://www.rdocumentation.org/packages/pbdDMAT/versions/0.5-1"><strong>pbdDMAT</strong></a> package added at the end of the code chunk below is to ensure that the data type for <code>nga_wp26392$Z.nf</code> and <code>nga_wp26392$Z.f</code> is a non-distributed vector instead of a distributed matrix. This is so that we can then append it to our dataframe later.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb124"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb124-1"><a href="#cb124-1" aria-hidden="true" tabindex="-1"></a>nga_wp26392<span class="sc">$</span>Z.nf <span class="ot">&lt;-</span> <span class="fu">scale</span>(nga_wp26392<span class="sc">$</span><span class="st">`</span><span class="at">wpt non-functional</span><span class="st">`</span>) <span class="sc">%&gt;%</span> as.vector</span>
<span id="cb124-2"><a href="#cb124-2" aria-hidden="true" tabindex="-1"></a>nga_wp26392<span class="sc">$</span>Z.f <span class="ot">&lt;-</span> <span class="fu">scale</span>(nga_wp26392<span class="sc">$</span><span class="st">`</span><span class="at">wpt functional</span><span class="st">`</span>) <span class="sc">%&gt;%</span> as.vector</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Plotting the Moran scatterplot again using the code chunk below, this time as <code>nci2</code> for non-functional water points and <code>nci2_f</code> for functional water points.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb125"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb125-1"><a href="#cb125-1" aria-hidden="true" tabindex="-1"></a>nci2 <span class="ot">&lt;-</span> <span class="fu">moran.plot</span>(nga_wp26392<span class="sc">$</span>Z.nf,</span>
<span id="cb125-2"><a href="#cb125-2" aria-hidden="true" tabindex="-1"></a>                   rswm_knn8,</span>
<span id="cb125-3"><a href="#cb125-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">labels =</span> <span class="fu">as.character</span>(nga_wp26392<span class="sc">$</span>shapeName),</span>
<span id="cb125-4"><a href="#cb125-4" aria-hidden="true" tabindex="-1"></a>                   <span class="at">xlab =</span> <span class="st">"z-No. of functional water points"</span>,</span>
<span id="cb125-5"><a href="#cb125-5" aria-hidden="true" tabindex="-1"></a>                   <span class="at">ylab =</span> <span class="st">"Spatially lagged z-No. of functional water points"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Take-home_Ex1_files/figure-html/unnamed-chunk-82-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb126"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb126-1"><a href="#cb126-1" aria-hidden="true" tabindex="-1"></a>nci2_f <span class="ot">&lt;-</span> <span class="fu">moran.plot</span>(nga_wp26392<span class="sc">$</span>Z.f,</span>
<span id="cb126-2"><a href="#cb126-2" aria-hidden="true" tabindex="-1"></a>                   rswm_knn8,</span>
<span id="cb126-3"><a href="#cb126-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">labels =</span> <span class="fu">as.character</span>(nga_wp26392<span class="sc">$</span>shapeName),</span>
<span id="cb126-4"><a href="#cb126-4" aria-hidden="true" tabindex="-1"></a>                   <span class="at">xlab =</span> <span class="st">"z-No. of functional water points"</span>,</span>
<span id="cb126-5"><a href="#cb126-5" aria-hidden="true" tabindex="-1"></a>                   <span class="at">ylab =</span> <span class="st">"Spatially lagged z-No. of functional water points"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Take-home_Ex1_files/figure-html/unnamed-chunk-83-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>We see that the x- and y-axes are scaled to 0 (for the division of the 4 quadrants).</p>
</section>
<section id="preparing-lisa-map-classes" class="level3">
<h3 class="anchored" data-anchor-id="preparing-lisa-map-classes">13.3. Preparing LISA Map Classes</h3>
<p>The code chunks below show the steps to prepare a LISA cluster map.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb127"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb127-1"><a href="#cb127-1" aria-hidden="true" tabindex="-1"></a>quadrant <span class="ot">&lt;-</span> <span class="fu">vector</span>(<span class="at">mode =</span> <span class="st">"numeric"</span>,</span>
<span id="cb127-2"><a href="#cb127-2" aria-hidden="true" tabindex="-1"></a>                   <span class="at">length =</span> <span class="fu">nrow</span>(localMI))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Next, we derive the spatially lagged variable of interest (i.e.&nbsp;no. of non-functional water points) and centre the variable of interest around its mean.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb128"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb128-1"><a href="#cb128-1" aria-hidden="true" tabindex="-1"></a>nga_wp26392<span class="sc">$</span>lag_wpt_nf <span class="ot">&lt;-</span> <span class="fu">lag.listw</span>(rswm_knn8, nga_wp26392<span class="sc">$</span><span class="st">`</span><span class="at">wpt non-functional</span><span class="st">`</span>)</span>
<span id="cb128-2"><a href="#cb128-2" aria-hidden="true" tabindex="-1"></a>DV <span class="ot">&lt;-</span> nga_wp26392<span class="sc">$</span><span class="st">`</span><span class="at">wpt non-functional</span><span class="st">`</span> <span class="sc">-</span> <span class="fu">mean</span>(nga_wp26392<span class="sc">$</span><span class="st">`</span><span class="at">wpt non-functional</span><span class="st">`</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This is followed by centering the local Moran’s I around its mean. This is for consistency with the <code>DV</code> method, and it is sufficient to simply use the local Moran’s I value without centering it around the mean (i.e.&nbsp;the code chunk below works the same as <code>C_mI &lt;- localMI[, 1]</code>).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb129"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb129-1"><a href="#cb129-1" aria-hidden="true" tabindex="-1"></a>C_mI <span class="ot">&lt;-</span> localMI[, <span class="dv">1</span>] <span class="sc">-</span> <span class="fu">mean</span>(localMI[, <span class="dv">1</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Then, we set a statistical significance level for local Moran’s at 5%.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb130"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb130-1"><a href="#cb130-1" aria-hidden="true" tabindex="-1"></a>signif <span class="ot">&lt;-</span> <span class="fl">0.05</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The next 4 command lines define the low-low (1), low-high (2), high-low (3) and high-high (4) quadrants.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb131"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb131-1"><a href="#cb131-1" aria-hidden="true" tabindex="-1"></a>quadrant[DV <span class="sc">&lt;</span> <span class="dv">0</span> <span class="sc">&amp;</span> C_mI <span class="sc">&gt;</span> <span class="dv">0</span>] <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="co"># C_mi &gt; 0 -&gt; cluster // DV_nf refers to no. of non-functional water points wrt mean -&gt; -ve means low-low</span></span>
<span id="cb131-2"><a href="#cb131-2" aria-hidden="true" tabindex="-1"></a>quadrant[DV <span class="sc">&lt;</span> <span class="dv">0</span> <span class="sc">&amp;</span> C_mI <span class="sc">&lt;</span> <span class="dv">0</span>] <span class="ot">&lt;-</span> <span class="dv">2</span> <span class="co"># C_mi &lt; 0 -&gt; outlier</span></span>
<span id="cb131-3"><a href="#cb131-3" aria-hidden="true" tabindex="-1"></a>quadrant[DV <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">&amp;</span> C_mI <span class="sc">&lt;</span> <span class="dv">0</span>] <span class="ot">&lt;-</span> <span class="dv">3</span> <span class="co"># C_mi &lt; 0 -&gt; outlier</span></span>
<span id="cb131-4"><a href="#cb131-4" aria-hidden="true" tabindex="-1"></a>quadrant[DV <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">&amp;</span> C_mI <span class="sc">&gt;</span> <span class="dv">0</span>] <span class="ot">&lt;-</span> <span class="dv">4</span> <span class="co"># C_mi &gt; 0 -&gt; cluster</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Finally, we place the non-significant Moran’s value in category 0.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb132"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb132-1"><a href="#cb132-1" aria-hidden="true" tabindex="-1"></a>quadrant[localMI[,<span class="dv">5</span>] <span class="sc">&gt;</span> signif] <span class="ot">&lt;-</span> <span class="dv">0</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>In fact, we can combine all the steps into a single code chunk below.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb133"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb133-1"><a href="#cb133-1" aria-hidden="true" tabindex="-1"></a>quadrant <span class="ot">&lt;-</span> <span class="fu">vector</span>(<span class="at">mode =</span> <span class="st">"numeric"</span>,</span>
<span id="cb133-2"><a href="#cb133-2" aria-hidden="true" tabindex="-1"></a>                   <span class="at">length =</span> <span class="fu">nrow</span>(localMI))</span>
<span id="cb133-3"><a href="#cb133-3" aria-hidden="true" tabindex="-1"></a>nga_wp26392<span class="sc">$</span>lag_wpt_nf <span class="ot">&lt;-</span> <span class="fu">lag.listw</span>(rswm_knn8, nga_wp26392<span class="sc">$</span><span class="st">`</span><span class="at">wpt non-functional</span><span class="st">`</span>)</span>
<span id="cb133-4"><a href="#cb133-4" aria-hidden="true" tabindex="-1"></a>DV <span class="ot">&lt;-</span> nga_wp26392<span class="sc">$</span><span class="st">`</span><span class="at">wpt non-functional</span><span class="st">`</span> <span class="sc">-</span> <span class="fu">mean</span>(nga_wp26392<span class="sc">$</span><span class="st">`</span><span class="at">wpt non-functional</span><span class="st">`</span>)</span>
<span id="cb133-5"><a href="#cb133-5" aria-hidden="true" tabindex="-1"></a>C_mI <span class="ot">&lt;-</span> localMI[, <span class="dv">1</span>] <span class="sc">-</span> <span class="fu">mean</span>(localMI[, <span class="dv">1</span>])</span>
<span id="cb133-6"><a href="#cb133-6" aria-hidden="true" tabindex="-1"></a>signif <span class="ot">&lt;-</span> <span class="fl">0.05</span></span>
<span id="cb133-7"><a href="#cb133-7" aria-hidden="true" tabindex="-1"></a>quadrant[DV <span class="sc">&lt;</span> <span class="dv">0</span> <span class="sc">&amp;</span> C_mI <span class="sc">&gt;</span> <span class="dv">0</span>] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb133-8"><a href="#cb133-8" aria-hidden="true" tabindex="-1"></a>quadrant[DV <span class="sc">&lt;</span> <span class="dv">0</span> <span class="sc">&amp;</span> C_mI <span class="sc">&lt;</span> <span class="dv">0</span>] <span class="ot">&lt;-</span> <span class="dv">2</span></span>
<span id="cb133-9"><a href="#cb133-9" aria-hidden="true" tabindex="-1"></a>quadrant[DV <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">&amp;</span> C_mI <span class="sc">&lt;</span> <span class="dv">0</span>] <span class="ot">&lt;-</span> <span class="dv">3</span></span>
<span id="cb133-10"><a href="#cb133-10" aria-hidden="true" tabindex="-1"></a>quadrant[DV <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">&amp;</span> C_mI <span class="sc">&gt;</span> <span class="dv">0</span>] <span class="ot">&lt;-</span> <span class="dv">4</span></span>
<span id="cb133-11"><a href="#cb133-11" aria-hidden="true" tabindex="-1"></a>quadrant[localMI[,<span class="dv">5</span>] <span class="sc">&gt;</span> signif] <span class="ot">&lt;-</span> <span class="dv">0</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="plotting-lisa-map-for-non-functional-water-points" class="level3">
<h3 class="anchored" data-anchor-id="plotting-lisa-map-for-non-functional-water-points">13.4. Plotting LISA Map for Non-Functional Water Points</h3>
<p>Finally, we can build the LISA map using the code chunk below.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb134"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb134-1"><a href="#cb134-1" aria-hidden="true" tabindex="-1"></a>wp_nf <span class="ot">&lt;-</span> <span class="fu">qtm</span>(nga_wp26392, <span class="st">"wpt non-functional"</span>, <span class="at">fill.palette =</span> <span class="st">"Blues"</span>)</span>
<span id="cb134-2"><a href="#cb134-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-3"><a href="#cb134-3" aria-hidden="true" tabindex="-1"></a>nga_wp26392.localMI<span class="sc">$</span>quadrant <span class="ot">&lt;-</span> quadrant</span>
<span id="cb134-4"><a href="#cb134-4" aria-hidden="true" tabindex="-1"></a>colors <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"#ffffff"</span>, <span class="co"># white for non-significant Moran's values</span></span>
<span id="cb134-5"><a href="#cb134-5" aria-hidden="true" tabindex="-1"></a>            <span class="st">"#f1fa73"</span>, <span class="co"># yellow for low-low</span></span>
<span id="cb134-6"><a href="#cb134-6" aria-hidden="true" tabindex="-1"></a>            <span class="st">"#91fa5c"</span>, <span class="co"># green for low-high</span></span>
<span id="cb134-7"><a href="#cb134-7" aria-hidden="true" tabindex="-1"></a>            <span class="st">"#5cfacb"</span>, <span class="co"># cyan for high-low</span></span>
<span id="cb134-8"><a href="#cb134-8" aria-hidden="true" tabindex="-1"></a>            <span class="st">"#1239ff"</span>) <span class="co"># blue for high-high</span></span>
<span id="cb134-9"><a href="#cb134-9" aria-hidden="true" tabindex="-1"></a>clusters <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"insignificant"</span>, <span class="st">"low-low"</span>, <span class="st">"low-high"</span>, <span class="st">"high-low"</span>, <span class="st">"high-high"</span>)</span>
<span id="cb134-10"><a href="#cb134-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-11"><a href="#cb134-11" aria-hidden="true" tabindex="-1"></a>LISAmap_nf <span class="ot">&lt;-</span> <span class="fu">tm_shape</span>(nga_wp26392.localMI) <span class="sc">+</span></span>
<span id="cb134-12"><a href="#cb134-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_fill</span>(<span class="at">col =</span> <span class="st">"quadrant"</span>, </span>
<span id="cb134-13"><a href="#cb134-13" aria-hidden="true" tabindex="-1"></a>          <span class="at">style =</span> <span class="st">"cat"</span>, </span>
<span id="cb134-14"><a href="#cb134-14" aria-hidden="true" tabindex="-1"></a>          <span class="at">palette =</span> colors[<span class="fu">c</span>(<span class="fu">sort</span>(<span class="fu">unique</span>(quadrant)))<span class="sc">+</span><span class="dv">1</span>], </span>
<span id="cb134-15"><a href="#cb134-15" aria-hidden="true" tabindex="-1"></a>          <span class="at">labels =</span> clusters[<span class="fu">c</span>(<span class="fu">sort</span>(<span class="fu">unique</span>(quadrant)))<span class="sc">+</span><span class="dv">1</span>]) <span class="sc">+</span></span>
<span id="cb134-16"><a href="#cb134-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_borders</span>(<span class="at">alpha=</span><span class="fl">0.5</span>)</span>
<span id="cb134-17"><a href="#cb134-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-18"><a href="#cb134-18" aria-hidden="true" tabindex="-1"></a><span class="fu">tmap_arrange</span>(wp_nf, LISAmap_nf, <span class="at">asp=</span><span class="dv">1</span>, <span class="at">ncol=</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Take-home_Ex1_files/figure-html/unnamed-chunk-91-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>The plot on the right shows that the statistically significant Moran’s I values are in blue for high-high autocorrelation and yellow for low-low autocorrelation (clusters). These regions are all found on the (i) Central, Southeast and Southwest parts (high-high) and (ii) Northeast and South parts (low-low) of Nigeria respectively. It also shows several outlier regions in green and cyan, generally in the proximity of high-high regions as well as low-low regions in the South.</p>
</section>
<section id="plotting-lisa-map-for-functional-water-points" class="level3">
<h3 class="anchored" data-anchor-id="plotting-lisa-map-for-functional-water-points">13.5. Plotting LISA Map for Functional Water Points</h3>
<p>We repeat the process to study the LISA map for functional water points. The code chunk below puts together the relevant preparation and plotting.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb135"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb135-1"><a href="#cb135-1" aria-hidden="true" tabindex="-1"></a>localMI_f <span class="ot">&lt;-</span> <span class="fu">localmoran</span>(nga_wp26392<span class="sc">$</span><span class="st">`</span><span class="at">wpt functional</span><span class="st">`</span>, </span>
<span id="cb135-2"><a href="#cb135-2" aria-hidden="true" tabindex="-1"></a>                      rswm_knn8, </span>
<span id="cb135-3"><a href="#cb135-3" aria-hidden="true" tabindex="-1"></a>                      <span class="at">zero.policy =</span> <span class="cn">TRUE</span>)</span>
<span id="cb135-4"><a href="#cb135-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb135-5"><a href="#cb135-5" aria-hidden="true" tabindex="-1"></a>nga_wp26392.localMI_f <span class="ot">&lt;-</span> <span class="fu">cbind</span>(nga_wp26392, localMI_f) <span class="sc">%&gt;%</span></span>
<span id="cb135-6"><a href="#cb135-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">Pr.Ii =</span> Pr.z....E.Ii..)</span>
<span id="cb135-7"><a href="#cb135-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb135-8"><a href="#cb135-8" aria-hidden="true" tabindex="-1"></a>quadrant <span class="ot">&lt;-</span> <span class="fu">vector</span>(<span class="at">mode =</span> <span class="st">"numeric"</span>,</span>
<span id="cb135-9"><a href="#cb135-9" aria-hidden="true" tabindex="-1"></a>                   <span class="at">length =</span> <span class="fu">nrow</span>(localMI_f))</span>
<span id="cb135-10"><a href="#cb135-10" aria-hidden="true" tabindex="-1"></a>nga_wp26392<span class="sc">$</span>lag_wpt_f <span class="ot">&lt;-</span> <span class="fu">lag.listw</span>(rswm_knn8, nga_wp26392<span class="sc">$</span><span class="st">`</span><span class="at">wpt functional</span><span class="st">`</span>)</span>
<span id="cb135-11"><a href="#cb135-11" aria-hidden="true" tabindex="-1"></a>DV <span class="ot">&lt;-</span> nga_wp26392<span class="sc">$</span><span class="st">`</span><span class="at">wpt functional</span><span class="st">`</span> <span class="sc">-</span> <span class="fu">mean</span>(nga_wp26392<span class="sc">$</span><span class="st">`</span><span class="at">wpt functional</span><span class="st">`</span>)</span>
<span id="cb135-12"><a href="#cb135-12" aria-hidden="true" tabindex="-1"></a>C_mI <span class="ot">&lt;-</span> localMI_f[, <span class="dv">1</span>] <span class="sc">-</span> <span class="fu">mean</span>(localMI_f[, <span class="dv">1</span>])</span>
<span id="cb135-13"><a href="#cb135-13" aria-hidden="true" tabindex="-1"></a>signif <span class="ot">&lt;-</span> <span class="fl">0.05</span></span>
<span id="cb135-14"><a href="#cb135-14" aria-hidden="true" tabindex="-1"></a>quadrant[DV <span class="sc">&lt;</span> <span class="dv">0</span> <span class="sc">&amp;</span> C_mI <span class="sc">&gt;</span> <span class="dv">0</span>] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb135-15"><a href="#cb135-15" aria-hidden="true" tabindex="-1"></a>quadrant[DV <span class="sc">&lt;</span> <span class="dv">0</span> <span class="sc">&amp;</span> C_mI <span class="sc">&lt;</span> <span class="dv">0</span>] <span class="ot">&lt;-</span> <span class="dv">2</span></span>
<span id="cb135-16"><a href="#cb135-16" aria-hidden="true" tabindex="-1"></a>quadrant[DV <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">&amp;</span> C_mI <span class="sc">&lt;</span> <span class="dv">0</span>] <span class="ot">&lt;-</span> <span class="dv">3</span></span>
<span id="cb135-17"><a href="#cb135-17" aria-hidden="true" tabindex="-1"></a>quadrant[DV <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">&amp;</span> C_mI <span class="sc">&gt;</span> <span class="dv">0</span>] <span class="ot">&lt;-</span> <span class="dv">4</span></span>
<span id="cb135-18"><a href="#cb135-18" aria-hidden="true" tabindex="-1"></a>quadrant[localMI[,<span class="dv">5</span>] <span class="sc">&gt;</span> signif] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb135-19"><a href="#cb135-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb135-20"><a href="#cb135-20" aria-hidden="true" tabindex="-1"></a>wp_f <span class="ot">&lt;-</span> <span class="fu">qtm</span>(nga_wp26392, <span class="st">"wpt functional"</span>, <span class="at">fill.palette =</span> <span class="st">"Blues"</span>)</span>
<span id="cb135-21"><a href="#cb135-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb135-22"><a href="#cb135-22" aria-hidden="true" tabindex="-1"></a>nga_wp26392.localMI_f<span class="sc">$</span>quadrant <span class="ot">&lt;-</span> quadrant</span>
<span id="cb135-23"><a href="#cb135-23" aria-hidden="true" tabindex="-1"></a>colors <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"#ffffff"</span>, <span class="co"># white for non-significant Moran's values</span></span>
<span id="cb135-24"><a href="#cb135-24" aria-hidden="true" tabindex="-1"></a>            <span class="st">"#f1fa73"</span>, <span class="co"># yellow for low-low</span></span>
<span id="cb135-25"><a href="#cb135-25" aria-hidden="true" tabindex="-1"></a>            <span class="st">"#91fa5c"</span>, <span class="co"># green for low-high</span></span>
<span id="cb135-26"><a href="#cb135-26" aria-hidden="true" tabindex="-1"></a>            <span class="st">"#5cfacb"</span>, <span class="co"># cyan for high-low</span></span>
<span id="cb135-27"><a href="#cb135-27" aria-hidden="true" tabindex="-1"></a>            <span class="st">"#1239ff"</span>) <span class="co"># blue for high-high</span></span>
<span id="cb135-28"><a href="#cb135-28" aria-hidden="true" tabindex="-1"></a>clusters <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"insignificant"</span>, <span class="st">"low-low"</span>, <span class="st">"low-high"</span>, <span class="st">"high-low"</span>, <span class="st">"high-high"</span>)</span>
<span id="cb135-29"><a href="#cb135-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb135-30"><a href="#cb135-30" aria-hidden="true" tabindex="-1"></a>LISAmap_f <span class="ot">&lt;-</span> <span class="fu">tm_shape</span>(nga_wp26392.localMI_f) <span class="sc">+</span></span>
<span id="cb135-31"><a href="#cb135-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_fill</span>(<span class="at">col =</span> <span class="st">"quadrant"</span>, </span>
<span id="cb135-32"><a href="#cb135-32" aria-hidden="true" tabindex="-1"></a>          <span class="at">style =</span> <span class="st">"cat"</span>, </span>
<span id="cb135-33"><a href="#cb135-33" aria-hidden="true" tabindex="-1"></a>          <span class="at">palette =</span> colors[<span class="fu">c</span>(<span class="fu">sort</span>(<span class="fu">unique</span>(quadrant)))<span class="sc">+</span><span class="dv">1</span>], </span>
<span id="cb135-34"><a href="#cb135-34" aria-hidden="true" tabindex="-1"></a>          <span class="at">labels =</span> clusters[<span class="fu">c</span>(<span class="fu">sort</span>(<span class="fu">unique</span>(quadrant)))<span class="sc">+</span><span class="dv">1</span>]) <span class="sc">+</span></span>
<span id="cb135-35"><a href="#cb135-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_borders</span>(<span class="at">alpha=</span><span class="fl">0.5</span>)</span>
<span id="cb135-36"><a href="#cb135-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb135-37"><a href="#cb135-37" aria-hidden="true" tabindex="-1"></a><span class="fu">tmap_arrange</span>(wp_f, LISAmap_f, <span class="at">asp=</span><span class="dv">1</span>, <span class="at">ncol=</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Take-home_Ex1_files/figure-html/unnamed-chunk-92-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>There are a lot less high-high and low-low regions (clusters) and more low-high and high-low regions (outliers) for number of functional water points than non-functional water points. Nevertheless, the broad areas for the clusters are outliers are consistent across both plots.</p>
</section>
</section>
<section id="hot-spot-and-cold-spot-area-analysis" class="level2">
<h2 class="anchored" data-anchor-id="hot-spot-and-cold-spot-area-analysis">14. Hot Spot and Cold Spot Area Analysis</h2>
<p>Besides detecting clusters and outliers, localised spatial statistics can also be used to detect hot and/or cold spot areas.</p>
<p>The term ‘hot spot’ has been used generically across disciplines to describe a region or value that is higher relative to its surroundings.</p>
<section id="getis-and-ords-g-statistics" class="level3">
<h3 class="anchored" data-anchor-id="getis-and-ords-g-statistics">14.1. Getis and Ord’s G-Statistics</h3>
<p>An alternative spatial statistics to detect spatial anomalies is the Getis and Ord’s G-statistics. It looks at neighbours within a defined proximity to identify where either high or low values clutser spatially. Here, statistically significant hot-spots are recognised as areas of high values where other areas within a neighbourhood range also share high values too.</p>
<p>The analysis consists of three steps:</p>
<ol type="1">
<li><p>Deriving spatial weight matrix (completed in section 9.7.)</p></li>
<li><p>Computing Gi statistics</p></li>
<li><p>Mapping Gi statistics</p></li>
</ol>
</section>
</section>
<section id="computing-gi-statistics" class="level2">
<h2 class="anchored" data-anchor-id="computing-gi-statistics">15. Computing Gi Statistics</h2>
<section id="gi-statistics-for-non-functional-water-points-using-fixed-distance" class="level3">
<h3 class="anchored" data-anchor-id="gi-statistics-for-non-functional-water-points-using-fixed-distance">15.1. Gi Statistics for Non-Functional Water Points Using Fixed Distance</h3>
<p>The code chunk below calculates the Gi statistics of the 774 LGAs using the fixed distance weights matrix.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb136"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb136-1"><a href="#cb136-1" aria-hidden="true" tabindex="-1"></a>fips <span class="ot">&lt;-</span> <span class="fu">order</span>(nga_wp26392<span class="sc">$</span>shapeName)</span>
<span id="cb136-2"><a href="#cb136-2" aria-hidden="true" tabindex="-1"></a>gi.fixed <span class="ot">&lt;-</span> <span class="fu">localG</span>(nga_wp26392<span class="sc">$</span><span class="st">`</span><span class="at">wpt non-functional</span><span class="st">`</span>, wm71_lw)</span>
<span id="cb136-3"><a href="#cb136-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(gi.fixed)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -3.4117747 -3.4325327 -1.5896655  0.1024036 -1.4372021  3.1612220</code></pre>
</div>
</div>
<p>The output of localG() is a vector of G or Gstar values, with attributes “gstari” set to TRUE or FALSE, “call” set to the function call, and class “localG”.</p>
<p>The Gi statistics is represented as a Z-score. Greater values represent a greater intensity of clustering and the direction (positive or negative) indicates high or low clusters.</p>
<p>Next, we will join the Gi values to their corresponding <code>nga_wp26392</code> sf dataframe by using the code chunk below.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb138"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb138-1"><a href="#cb138-1" aria-hidden="true" tabindex="-1"></a>nga_wp26392.gi <span class="ot">&lt;-</span> <span class="fu">cbind</span>(nga_wp26392, <span class="fu">as.matrix</span>(gi.fixed)) <span class="sc">%&gt;%</span></span>
<span id="cb138-2"><a href="#cb138-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">gstat_fixed =</span> as.matrix.gi.fixed.)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The code chunk above performs three tasks. First, it convert the output vector (i.e.&nbsp;<code>gi.fixed</code>) into r matrix object by using <em>as.matrix()</em>. Next, <em>cbind()</em> is used to join <code>nga_wp26392</code> and <code>gi.fixed</code> matrix to produce a new SpatialPolygonDataFrame called <code>nga_wp26392.gi</code>. Lastly, the field name of the gi values is renamed to <code>gstat_fixed</code> by using <em>rename()</em>.</p>
</section>
<section id="gi-statistics-for-non-functional-water-points-using-adaptivedistance" class="level3">
<h3 class="anchored" data-anchor-id="gi-statistics-for-non-functional-water-points-using-adaptivedistance">15.2. Gi Statistics for Non-Functional Water Points Using AdaptiveDistance</h3>
<p>The code chunk below are used to compute the Gi values for number of non-functional water points by using an adaptive distance weight matrix (i.e <code>rswm_knn8</code>).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb139"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb139-1"><a href="#cb139-1" aria-hidden="true" tabindex="-1"></a>fips <span class="ot">&lt;-</span> <span class="fu">order</span>(nga_wp26392<span class="sc">$</span>shapeName)</span>
<span id="cb139-2"><a href="#cb139-2" aria-hidden="true" tabindex="-1"></a>gi.adaptive <span class="ot">&lt;-</span> <span class="fu">localG</span>(nga_wp26392<span class="sc">$</span><span class="st">`</span><span class="at">wpt non-functional</span><span class="st">`</span>, rswm_knn8)</span>
<span id="cb139-3"><a href="#cb139-3" aria-hidden="true" tabindex="-1"></a>nga_wp26392.gi <span class="ot">&lt;-</span> <span class="fu">cbind</span>(nga_wp26392.gi, <span class="fu">as.matrix</span>(gi.adaptive)) <span class="sc">%&gt;%</span></span>
<span id="cb139-4"><a href="#cb139-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">gstat_adaptive =</span> as.matrix.gi.adaptive.)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="mapping-gi-values-for-non-functional-water-points-with-fixed-and-adaptive-distance-weights" class="level3">
<h3 class="anchored" data-anchor-id="mapping-gi-values-for-non-functional-water-points-with-fixed-and-adaptive-distance-weights">15.3. Mapping Gi Values for Non-Functional Water Points with Fixed and Adaptive Distance Weights</h3>
<p>The code chunk below shows the functions used to map the Gi values derived using fixed and adaptive distance weights matrix, with respect to the number of non-functional water points.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb140"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb140-1"><a href="#cb140-1" aria-hidden="true" tabindex="-1"></a>Gimap.fixed <span class="ot">&lt;-</span> <span class="fu">tm_shape</span>(nga_wp26392.gi) <span class="sc">+</span> </span>
<span id="cb140-2"><a href="#cb140-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_fill</span>(<span class="at">col =</span> <span class="st">"gstat_fixed"</span>,</span>
<span id="cb140-3"><a href="#cb140-3" aria-hidden="true" tabindex="-1"></a>          <span class="at">style =</span> <span class="st">"pretty"</span>,</span>
<span id="cb140-4"><a href="#cb140-4" aria-hidden="true" tabindex="-1"></a>          <span class="at">palette =</span> <span class="st">"RdBu"</span>,</span>
<span id="cb140-5"><a href="#cb140-5" aria-hidden="true" tabindex="-1"></a>          <span class="at">title =</span> <span class="st">"Local Gi"</span>) <span class="sc">+</span></span>
<span id="cb140-6"><a href="#cb140-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_borders</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb140-7"><a href="#cb140-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_layout</span>(<span class="at">main.title =</span> <span class="st">"Fixed distance weights matrix"</span>,</span>
<span id="cb140-8"><a href="#cb140-8" aria-hidden="true" tabindex="-1"></a>            <span class="at">main.title.size =</span> <span class="fl">0.9</span>,</span>
<span id="cb140-9"><a href="#cb140-9" aria-hidden="true" tabindex="-1"></a>            <span class="at">main.title.position =</span> <span class="st">"center"</span>,</span>
<span id="cb140-10"><a href="#cb140-10" aria-hidden="true" tabindex="-1"></a>            <span class="at">legend.height =</span> <span class="fl">0.25</span>, </span>
<span id="cb140-11"><a href="#cb140-11" aria-hidden="true" tabindex="-1"></a>            <span class="at">legend.width =</span> <span class="fl">0.35</span>)</span>
<span id="cb140-12"><a href="#cb140-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb140-13"><a href="#cb140-13" aria-hidden="true" tabindex="-1"></a>Gimap.adaptive <span class="ot">&lt;-</span> <span class="fu">tm_shape</span>(nga_wp26392.gi) <span class="sc">+</span> </span>
<span id="cb140-14"><a href="#cb140-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_fill</span>(<span class="at">col =</span> <span class="st">"gstat_adaptive"</span>,</span>
<span id="cb140-15"><a href="#cb140-15" aria-hidden="true" tabindex="-1"></a>          <span class="at">style =</span> <span class="st">"pretty"</span>,</span>
<span id="cb140-16"><a href="#cb140-16" aria-hidden="true" tabindex="-1"></a>          <span class="at">palette =</span> <span class="st">"RdBu"</span>,</span>
<span id="cb140-17"><a href="#cb140-17" aria-hidden="true" tabindex="-1"></a>          <span class="at">title =</span> <span class="st">"Local Gi"</span>) <span class="sc">+</span></span>
<span id="cb140-18"><a href="#cb140-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_borders</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb140-19"><a href="#cb140-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_layout</span>(<span class="at">main.title =</span> <span class="st">"Adaptive distance weights matrix"</span>,</span>
<span id="cb140-20"><a href="#cb140-20" aria-hidden="true" tabindex="-1"></a>            <span class="at">main.title.size =</span> <span class="fl">0.9</span>,</span>
<span id="cb140-21"><a href="#cb140-21" aria-hidden="true" tabindex="-1"></a>            <span class="at">main.title.position =</span> <span class="st">"center"</span>,</span>
<span id="cb140-22"><a href="#cb140-22" aria-hidden="true" tabindex="-1"></a>            <span class="at">legend.height =</span> <span class="fl">0.25</span>, </span>
<span id="cb140-23"><a href="#cb140-23" aria-hidden="true" tabindex="-1"></a>            <span class="at">legend.width =</span> <span class="fl">0.35</span>)</span>
<span id="cb140-24"><a href="#cb140-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb140-25"><a href="#cb140-25" aria-hidden="true" tabindex="-1"></a><span class="fu">tmap_arrange</span>(Gimap.fixed,</span>
<span id="cb140-26"><a href="#cb140-26" aria-hidden="true" tabindex="-1"></a>             Gimap.adaptive,</span>
<span id="cb140-27"><a href="#cb140-27" aria-hidden="true" tabindex="-1"></a>             <span class="at">asp =</span> <span class="dv">1</span>,</span>
<span id="cb140-28"><a href="#cb140-28" aria-hidden="true" tabindex="-1"></a>             <span class="at">ncol =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Take-home_Ex1_files/figure-html/unnamed-chunk-96-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>We observe that the hot spots (surrounded by high numbers of non-functional water points with positive Local Gi, in blue) and cold spots (surrounded by low numbers of non-functional water points with negative Gi, in orange), are largely consistent between the fixed and adaptive distance methods. The hot spots tend to occur in the Central, Southwest and Southeast regions of Nigeria, while cold spots are found more in the Northeast, South, West and Northwest regions. The fixed distance method shows a wider range of Local Gi values, from ~-8 to ~8, versus ~-4 to ~6 for adaptive distance method. Notably, the fixed distance method showed interesting radiating patterns of hot spots and cold spots in the South and Southwest regions respectively, where the centre of those regions are hotter (Awka South) and colder (Ila) respective and get closer to 0 as the area spreads (see screenshot below). Such a pattern is not observed in the plot using the adaptive distance method. This may suggest that the LGAs with hot spots should be looked into for reasons of higher numbers of non-functioning water points, and potentially learn from the LGAs with cold spots.</p>
<p><img src="images/paste-4CF2D602.png" class="img-fluid" width="232"></p>
<p><img src="images/paste-7179DBE5.png" class="img-fluid"></p>
</section>
<section id="gi-statistics-for-functional-water-points-using-fixed-distance" class="level3">
<h3 class="anchored" data-anchor-id="gi-statistics-for-functional-water-points-using-fixed-distance">15.4. Gi Statistics for Functional Water Points Using Fixed Distance</h3>
<p>We repeat the process for functional water points to determine whether there is any notable trends.</p>
<p>The code chunk below calculates the Gi statistics of the 774 LGAs using the fixed distance weights matrix.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb141"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb141-1"><a href="#cb141-1" aria-hidden="true" tabindex="-1"></a>fips <span class="ot">&lt;-</span> <span class="fu">order</span>(nga_wp26392<span class="sc">$</span>shapeName)</span>
<span id="cb141-2"><a href="#cb141-2" aria-hidden="true" tabindex="-1"></a>gi.fixed <span class="ot">&lt;-</span> <span class="fu">localG</span>(nga_wp26392<span class="sc">$</span><span class="st">`</span><span class="at">wpt functional</span><span class="st">`</span>, wm71_lw)</span>
<span id="cb141-3"><a href="#cb141-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(gi.fixed)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -4.7966255 -4.7601280 -1.1787856 -0.3266329 -4.7190630  1.6971466</code></pre>
</div>
</div>
<p>Next, we will join the Gi values to their corresponding <code>nga_wp26392</code> sf dataframe by using the code chunk below.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb143"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb143-1"><a href="#cb143-1" aria-hidden="true" tabindex="-1"></a>nga_wp26392.gi <span class="ot">&lt;-</span> <span class="fu">cbind</span>(nga_wp26392, <span class="fu">as.matrix</span>(gi.fixed)) <span class="sc">%&gt;%</span></span>
<span id="cb143-2"><a href="#cb143-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">gstat_fixed =</span> as.matrix.gi.fixed.)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The code chunk above performs three tasks. First, it convert the output vector (i.e.&nbsp;<code>gi.fixed</code>) into r matrix object by using <em>as.matrix()</em>. Next, <em>cbind()</em> is used to join <code>nga_wp26392</code> and <code>gi.fixed</code> matrix to produce a new SpatialPolygonDataFrame called <code>nga_wp26392.gi</code>. Lastly, the field name of the gi values is renamed to <code>gstat_fixed</code> by using <em>rename()</em>.</p>
</section>
<section id="gi-statistics-for-functional-water-points-using-adaptivedistance" class="level3">
<h3 class="anchored" data-anchor-id="gi-statistics-for-functional-water-points-using-adaptivedistance">15.5. Gi Statistics for Functional Water Points Using AdaptiveDistance</h3>
<p>The code chunk below are used to compute the Gi values for number of functional water points by using an adaptive distance weight matrix (i.e <code>rswm_knn8</code>).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb144"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb144-1"><a href="#cb144-1" aria-hidden="true" tabindex="-1"></a>fips <span class="ot">&lt;-</span> <span class="fu">order</span>(nga_wp26392<span class="sc">$</span>shapeName)</span>
<span id="cb144-2"><a href="#cb144-2" aria-hidden="true" tabindex="-1"></a>gi.adaptive <span class="ot">&lt;-</span> <span class="fu">localG</span>(nga_wp26392<span class="sc">$</span><span class="st">`</span><span class="at">wpt functional</span><span class="st">`</span>, rswm_knn8)</span>
<span id="cb144-3"><a href="#cb144-3" aria-hidden="true" tabindex="-1"></a>nga_wp26392.gi <span class="ot">&lt;-</span> <span class="fu">cbind</span>(nga_wp26392.gi, <span class="fu">as.matrix</span>(gi.adaptive)) <span class="sc">%&gt;%</span></span>
<span id="cb144-4"><a href="#cb144-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">gstat_adaptive =</span> as.matrix.gi.adaptive.)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="mapping-gi-values-for-functional-water-points-with-fixed-and-adaptive-distance-weights" class="level3">
<h3 class="anchored" data-anchor-id="mapping-gi-values-for-functional-water-points-with-fixed-and-adaptive-distance-weights">15.6. Mapping Gi Values for Functional Water Points with Fixed and Adaptive Distance Weights</h3>
<p>The code chunk below shows the functions used to map the Gi values derived using fixed and adaptive distance weights matrix, with respect to the number of functional water points.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb145"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb145-1"><a href="#cb145-1" aria-hidden="true" tabindex="-1"></a>Gimap.fixed <span class="ot">&lt;-</span> <span class="fu">tm_shape</span>(nga_wp26392.gi) <span class="sc">+</span> </span>
<span id="cb145-2"><a href="#cb145-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_fill</span>(<span class="at">col =</span> <span class="st">"gstat_fixed"</span>,</span>
<span id="cb145-3"><a href="#cb145-3" aria-hidden="true" tabindex="-1"></a>          <span class="at">style =</span> <span class="st">"pretty"</span>,</span>
<span id="cb145-4"><a href="#cb145-4" aria-hidden="true" tabindex="-1"></a>          <span class="at">palette =</span> <span class="st">"RdBu"</span>,</span>
<span id="cb145-5"><a href="#cb145-5" aria-hidden="true" tabindex="-1"></a>          <span class="at">title =</span> <span class="st">"Local Gi"</span>) <span class="sc">+</span></span>
<span id="cb145-6"><a href="#cb145-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_borders</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb145-7"><a href="#cb145-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_layout</span>(<span class="at">main.title =</span> <span class="st">"Fixed distance weights matrix"</span>,</span>
<span id="cb145-8"><a href="#cb145-8" aria-hidden="true" tabindex="-1"></a>            <span class="at">main.title.size =</span> <span class="fl">0.9</span>,</span>
<span id="cb145-9"><a href="#cb145-9" aria-hidden="true" tabindex="-1"></a>            <span class="at">main.title.position =</span> <span class="st">"center"</span>,</span>
<span id="cb145-10"><a href="#cb145-10" aria-hidden="true" tabindex="-1"></a>            <span class="at">legend.height =</span> <span class="fl">0.25</span>, </span>
<span id="cb145-11"><a href="#cb145-11" aria-hidden="true" tabindex="-1"></a>            <span class="at">legend.width =</span> <span class="fl">0.35</span>)</span>
<span id="cb145-12"><a href="#cb145-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb145-13"><a href="#cb145-13" aria-hidden="true" tabindex="-1"></a>Gimap.adaptive <span class="ot">&lt;-</span> <span class="fu">tm_shape</span>(nga_wp26392.gi) <span class="sc">+</span> </span>
<span id="cb145-14"><a href="#cb145-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_fill</span>(<span class="at">col =</span> <span class="st">"gstat_adaptive"</span>,</span>
<span id="cb145-15"><a href="#cb145-15" aria-hidden="true" tabindex="-1"></a>          <span class="at">style =</span> <span class="st">"pretty"</span>,</span>
<span id="cb145-16"><a href="#cb145-16" aria-hidden="true" tabindex="-1"></a>          <span class="at">palette =</span> <span class="st">"RdBu"</span>,</span>
<span id="cb145-17"><a href="#cb145-17" aria-hidden="true" tabindex="-1"></a>          <span class="at">title =</span> <span class="st">"Local Gi"</span>) <span class="sc">+</span></span>
<span id="cb145-18"><a href="#cb145-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_borders</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb145-19"><a href="#cb145-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_layout</span>(<span class="at">main.title =</span> <span class="st">"Adaptive distance weights matrix"</span>,</span>
<span id="cb145-20"><a href="#cb145-20" aria-hidden="true" tabindex="-1"></a>            <span class="at">main.title.size =</span> <span class="fl">0.9</span>,</span>
<span id="cb145-21"><a href="#cb145-21" aria-hidden="true" tabindex="-1"></a>            <span class="at">main.title.position =</span> <span class="st">"center"</span>,</span>
<span id="cb145-22"><a href="#cb145-22" aria-hidden="true" tabindex="-1"></a>            <span class="at">legend.height =</span> <span class="fl">0.25</span>, </span>
<span id="cb145-23"><a href="#cb145-23" aria-hidden="true" tabindex="-1"></a>            <span class="at">legend.width =</span> <span class="fl">0.35</span>)</span>
<span id="cb145-24"><a href="#cb145-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb145-25"><a href="#cb145-25" aria-hidden="true" tabindex="-1"></a><span class="fu">tmap_arrange</span>(Gimap.fixed,</span>
<span id="cb145-26"><a href="#cb145-26" aria-hidden="true" tabindex="-1"></a>             Gimap.adaptive,</span>
<span id="cb145-27"><a href="#cb145-27" aria-hidden="true" tabindex="-1"></a>             <span class="at">asp =</span> <span class="dv">1</span>,</span>
<span id="cb145-28"><a href="#cb145-28" aria-hidden="true" tabindex="-1"></a>             <span class="at">ncol =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Take-home_Ex1_files/figure-html/unnamed-chunk-100-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Similar to the Gi plots for non-functional water points, the Local Gi values for functional water points have a wider range using fixed distance weight matrix compared to adaptive distance weight matrix. Hot spots are generally seen in the North to Central/Southwest and Southeast regions, while cold spots cover the Northeast, Northwest and South regions, quite similar to what we saw for the non-functional water points.</p>
<p>Given that hot spots for non-functional water points tend to coexist with hot spots for functional water points, we may need to use the <u>proportion</u> rather than the absolute number of water points as future works.</p>
</section>
</section>
<section id="references" class="level2">
<h2 class="anchored" data-anchor-id="references">16. References</h2>
<p>ArcGIS desktop (2021). <em>Modeling spatial relationships.</em> https://desktop.arcgis.com/en/arcmap/latest/tools/spatial-statistics-toolbox/modeling-spatial-relationships.htm#GUID-DB9C20A7-51DB-4704-A0D7-1D4EA22C23A7</p>
<p>epsg.io (2022). <em>EPSG: 26392 Minna / Nigeria Mid Belt.</em> https://epsg.io/26392</p>
<p>Kam, T. S., &amp; Zhi, V. (2018) “Is There Space for Violence? A Data-driven Approach to the Exploration of Spatial-Temporal Dimensions of Conflict”. <em>Proceedings of the 2nd ACM SIGSPATIAL Workshop on Geospatial Humanities, Seattle, WA, USA, 2018 November 6</em>. 1-10. Research Collection School of Information Systems. https://doi.org/10.1145/1234567890</p>
<p>Library of Congress (2013 August 23). <em>Cameroon; Nigeria: Bakassi Peninsula Transition Completed.</em> https://www.loc.gov/item/global-legal-monitor/2013-08-23/cameroon-nigeria-bakassi-peninsula-transition-completed/</p>
<p>MapTools (2022). <em>Symbols for degrees, minutes and second.</em> https://www.maptools.com/tutorials/lat_lon/formats</p>
<p>Spatial Reference (2022). <em>EPSG: 26392.</em> https://spatialreference.org/ref/epsg/26392/</p>
<p>Statistics How To (2022). <em>Moran’s I: Definition, Examples</em>. https://www.statisticshowto.com/morans-i/</p>
<p>Tobler W. (1970) <a href="https://web.archive.org/web/20190308014451/http://pdfs.semanticscholar.org/eaa5/eefedd4fa34b7de7448c0c8e0822e9fdf956.pdf">“A computer movie simulating urban growth in the Detroit region”</a>. <em>Economic Geography</em>, 46(Supplement): 234–240.</p>
<p>United Nations (2022). <em>Goals 6 Ensure availability and sustainable management of water and sanitation for all.</em> https://sdgs.un.org/goals/goal6</p>
<p>VOA news (2022 March 21). <em>UNICEF Nigeria Warns Millions at Risk of Water Contamination Ailments.</em> https://www.voanews.com/a/unicef-nigeria-warns-millions-at-risk-of-water-contamination-ailments/6494928.html</p>
<p>Water Point Data Exchange (2020). <em>Water Point Data Exchange.</em> https://www.waterpointdata.org/</p>
</section>
<section id="learning-points-from-peers" class="level2">
<h2 class="anchored" data-anchor-id="learning-points-from-peers">17. Learning Points from Peers</h2>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    setTimeout(function() {
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script>
</div> <!-- /content -->



</body></html>